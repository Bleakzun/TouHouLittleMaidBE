
-----

【女仆系统】
完成：
 魂符、相机、照片、胶片
 复活、召唤、照相机合成配方
 home模式、跟随模式（用minecraft:is_baby标记）
 空闲模式、近战模式
 三种背包及合成配方、渲染、换包交互（手持背包shift右键）。
 声音：
    mob.thlmm.maid.death        自动触发
    mob.thlmm.maid.find_target
    mob.thlmm.maid.hurt_player
    mob.thlmm.maid.hurt         受伤  自动触发
    mob.thlmm.maid.item_get
    mob.thlmm.maid.tamed        拐骗成功  脚本触发

    mob.thlmm.maid.cold     1 
    mob.thlmm.maid.hot      2 
    mob.thlmm.maid.rain     3 
    mob.thlmm.maid.snow     4

    mob.thlmm.maid.morning     早安  行为包触发
    mob.thlmm.maid.night       晚安  行为包触发

    mob.thlmm.maid.attack      攻击模式  脚本触发 切换模式时
    mob.thlmm.maid.feed        喂养模式  脚本触发 切换模式时
    mob.thlmm.maid.idle        休息模式  自动触发 存在频率过高的问题

    mob.thlmm.maid.credit
  为了使用静音模式，以后应该都会改成脚本触发

下一步：
1. 完善私有背包与背包实体之间物品的传递，同时修改阵亡/收回时的相关处理
完善各状态动画
完善各状态音效
完善索敌，有时候不能及时锁定，锁定后还会出现丢锁的情况
拾物模式（用tag标注）
添加模型包加载功能（考虑由像素图表示模型，没有图则展示名称，这需要让图的UI叠在文字上方）
添加第一轮的全部工作模式
*相册（如果lore没有上限或者在装满的状态不会溢出，可以考虑加一个）
*表情显示（非核心功能，不过已经写了一点了）
转beta

...

转正式版
在mc百科制作介绍

交互设计
  右击：坐
  左击：打开菜单
  潜行右击：打开背包
  潜行手持背包右击：切换背包


前缀意义：
  thlmm：女仆专属的实体命名空间、生物事件命名空间
  api: 用于脚本访问的事件接口
  mode：模式

特殊值分配：
  skin_id: 皮肤编号
  variant：工作模式
  mark_variant：待定

关于背包
  因为女仆的物品栏还要用作种植、装护甲，物品不能总是放实体背包，实体背包只是供玩家交互的。
  利用只有潜行才能与背包交互的特性，进入潜行时，将女仆包内的物品剪切进背包，护甲、饰品及手上的物品复制进背包
  退出潜行时，背包物品放回女仆背包，装备则更新信息

关于附加模型包
  模型包最好是能独立于主包，需要找到脚本之间通信的手段。
  模型包肯定是要定义新实体的，或许可以考虑在主包预留位置，然后由附加模型包传递信号给主包，让主包激活模型包。（即将该模型包的内容加到脚本处理中）
  <!-- 又或许可以不用？直接用skin_id和mark_varian来决定哪些模型被加载，模型包就可以光资源包了，这两个属性应该都是能被脚本直接修改的。前提是render_controller可被定义多次。不然还是要预留位置。不过预留也是很简单的，多生成几个entity的定义文件就行。（估计不太行，render_controller怎么能定义多次呢） -->

长期计划
*（特色）好感度。到达一定值可以解锁cosplay服装、专属武器合成配方、支援弹幕（类似地灵殿，会自动攻击玩家攻击的实体）。互动、赠送礼物可以升高，均有冷却时间；战死、过度工作则会降低。
*（特色）学习。学习可以获得经验值，提高等级从而做更多事情，掌握更多技能（如解锁弹幕攻击方式）
*（方案）使用实体菜单进行模式选择，为保证准确性，只有静止时才能有效点击。即在坐下状态下菜单才会展开。
*（特色）幻翼鲨手模式：大功率发射只伤害幻翼的弹幕
*（注意）女仆的实体定义需要一个模板和更新脚本，因为一些女仆可能需要分开定义。
拟定的结构：thlmm:maid_define_xxx使用variant定义所有的女仆实体，然后在脚本里设置特定variant对应的特殊女仆命名空间，在variant变更时会检测是否为特殊定义，若是则发生转变。
    特殊定义的格式为 thlmm:maid_special_xxx

模式选择图标：
+    空闲        羽毛    items/feather.png
+    近战攻击    钻石剑  items/diamond_sword.png
+    弓兵        弓      items/bow_standby.png
+    弹幕攻击    御币     items/hakurei_gohei.png
+    农场        铁锄    items/iron_hoe.png
+    幻翼杀手    幻翼膜   items/phantom_membrane.png
（加号是第一轮实现的模式）
*    甘蔗        甘蔗     items/reeds.png
*    瓜类        西瓜片   items/melon.png
*    可可        可可豆   items/dye_powder_brown.png
*    花草        单层草   items/tallgrass.png
*    清雪        雪球     items/snowball.png
*    喂食        熟牛排   items/beef_cooked.png
*    剪刀        剪刀     items/shears.png
*    牛奶        牛奶     items/bucket_milk.png
*    火把        火把     items/torch_on.png
*    繁殖动物    小麦     items/wheat.png
*    灭火        灭火器   items/extinguisher.png
*    钓鱼        鱼竿

得研究一下子包怎么做，还有脚本能不能共用，以提高可拓展。

-----

【实体菜单】（或许会使用普通表单）
  女仆的背包界面使用基础物品栏，可能可以从npc的ui借用一个模型预览组件
  切换模式的操作就得用有多种选项的菜单了。拟定实现方案：
  参考minecar，实现物品界面和按钮界面两种交互结果

> 架构（自顶向下）
  js脚本层提供一个创建表单的接口，可以创建按钮并指定它们的位置、被点击后执行的函数。

  实体层接收玩家的攻击，并将信号传递给脚本层。能够触发事件的应该只有被指定的玩家。实体事件传给脚本之后只剩下很少的信息，所以要尝试在数驱部分做检测，或者转而监听实体受击事件。若监听受击，则应该只在菜单展开时监听，否则会造成较大的性能占用。

> 选项实体  
  选项实体有一个动态属性，用于记录调出者的id，无重力，无视所有攻击，在受击时会触发事件。
  每个选项均有两种状态，选中与未选中。选中时会额外显示绿色边框。
  选项是可被命名的，被指向时，会展示字幕。
  所有选项实体均由产生菜单的主体控制，并有自毁倒计时，主体会定时激活选项实体的事件将其倒计时清零。
  实体的命名空间以"thlmm:"(touhou little maid menu)作为前缀。

> 菜单项：
命名空间分配（xx是两位数字）：
  一级菜单：maid_main_xx
  二级菜单（按功能命名）：maid_mode_xx、maid_status_xx
  按钮：确认、取消、返回、上一页、下一页

-----

【祭坛合成与P点系统】
（待完善）用entity_sensor（使用例见女仆）代替脚本进行扫描
*（待修复）新版本中手上没有物品则不会触发beforeItemUseOn事件，导致空手取下祭坛上的物品失效，需要另寻它法。目前不是很急，因为可以跳起来取。
（待加入）庭灯：可以存储P点，打掉之后P点会以lore的形式存储在物品之中（需要测试lore中是否能包含translate文本）
（待完善）参考Philip枪械模组的弹药显示，使用动画优化p点显示，避免不停扫描主手物品。

-----

【弹幕系统】
（待完善）修改符札弹渲染方案，角度朝向运动方向，自转跟随加速度方向
（待完善）弹幕的inaccuracy与java保持一致
（待完善）妖精女仆发射弹幕时播放雪球声音
（待完善）用mark_variant或直接播放缩放动画来设置缩放倍率scale。()
（待加入）冲击炸弹 冲击效果非常强，伤害一般
（待加入）判定点。受击时计算与玩家的距离，在范围内才触发伤害。潜行时显示虚化身体骨骼并显示判定点（可选，因为可能与别的addon不兼容）。
（待加入）参考凋灵风暴制作魔炮,外层混合内层发光。
（待加入）实体不会被同组弹幕击伤。弹幕编组tag前缀：tdg，如tdgxxx （touhou danmaku group）。为提高性能，弹幕自身和玩家的编组靠动态属性标记。
    受击判定时，若找不到发射实体，则查看弹幕是否被标记。不过目前还没有无发射者的弹幕，估以后也不会有。
（待加入）八卦炉：长按即可发射，不同发射模式有不同的发射时长上限和冷却时间，一旦发射能量耗尽就会进入对应的冷却阶段。发射模式：低火力星弹、高火力星弹、激光、魔炮；在扫帚上使用能加速。
（待完善）试验伤害（damage）是否能为小数，若是，则更新entitydanmaku和danmakushoot的setDamage参数为Float
（待加入）basic弹幕：激光。利用scale随时间变化达到无限长度射击的效果，击中目标后，激光会停止拉长并立即消失。或许可以射出实际的、透明的战斗部，然后用粒子效果展现激光。
（待加入）Advanced弹幕：达到某一条件（如速度、位置、触地、击中）后就触发事件的弹幕。  发射一枚斜向上的弹幕，
（待加入）自定义弹幕：命名时用“custom”和原先的basic组分开。
（待加入）Advanced弹幕：编组弹幕。在生成后会召唤出基础弹幕，随后操控它们的运动状态。如灵乌路空的原子模型
（待加入）Advanced弹幕：阴阳玉。触地反弹。
（待加入）Advanced弹幕：追踪符札：[ 纸×3 + 火药 + 炸药/药水/纸 ] 在祭坛消耗0.5P点合成 [ 符札×8 ]。符札会自动追踪发射时瞄准的实体，若发射时视线上没有实体，则自行寻找运行方向上最近的敌对生物；基础伤害等于力量4的弓射出的箭，第三项合成材料为药水时会附带对应的药水效果，时长同药水箭，为炸药时造成范围伤害，为纸时仅造成基础单体伤害。
（待加入）冈格尼尔：高级三叉戟。
（待加入）支持多种欧拉角旋转次序
（待完善）加入可设置的重力：因为不能动态设置重力，采用跃迁式的设置方式，0-1，每0.1设一段，向上取整地设置重力
（待完善）可设置的变向变力：提供两个函数接口： 方向随时间变化的函数 和 大小随时间变化的函数。为性能考虑，在生成该类弹幕后会保留对其的引用，每游戏刻主动修改其动量。
（待完善）可设置的运动轨迹：提供一个函数接口： 弹幕位置随时间变化的函数。 为性能考虑，在生成该类弹幕后会保留对其的引用，每游戏刻主动修改其动量。
    计算方法是先算出下一游戏刻应该处于的位置，然后计算要到达该位置应有的动量，最后将动量设置为应有的动量。设置有两种方法，一种是清空直接设置，另一种是在原有基础上叠加，需要测试二者的性能谁更强。
PS：变向变力与运动轨迹均可以选择世界坐标和相对坐标。
*（待完善）各弹种的判定范围（可能无法实现）
PS：角色的特色武器可以设定为无法合成，只能在对应女仆好感度达到一定等级时获取。
PS：大多数stg符卡都较难作为玩家发射的弹幕，因为指向性不强，效果可能不如被怪物释放
PS：obj转模型虽然不能直接用，但是可以帮助定位，加快建模速度
用q.get_name制作命名彩蛋

（无法完善）给御币加上使用周期，从而取消食物动画。虽然食物动画取消了，但手部动画也没了，其它玩家看不出是不是在蓄力，要增加动画的判定则要修改player相关的文件，会降低兼容性。


-----
【boss生物】
计划利用末影龙变体和附着物实现无限距离加载
切赛德（光环超酷！）
魔理沙（符卡还原相对简单）
藤原妹红（时间陷阱可用）

-----

【其它】

*（未使用）闪烁贴图：见danmaku_basic render的注释部分
*（费力见效少）使用ui制作记忆中的幻想乡。
* 扫帚，玩家坐上去之后视角向上按前进就可以飞，参考minecar的飞行矿车。
数字显示参考 https://mcpedl.com/damage-count/