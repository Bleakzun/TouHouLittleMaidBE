
## 计划

√ 补充弹幕攻击的目标白名单
√ 取消女仆箱子必须由主人打开的要求
√ 修复伤害倍率计算错误的bug

√ 解决有初速度时，进入自制坐下状态会滑行的问题（修改behavior而不是删除它）
√ 坐下时不再播放行走动画

p点获取方式改为getscore
修复手办右击物品展示框等方块会导致复制的bug

尝试去除背包实体
√ 潜行交互进入查包状态
√ 非潜行交互切换站起与坐下模式
√ 改名正常显示
√ 换包交互
取消背包对象，旧背包对象的操作并入坟墓实体

和java版是反着来的，因为查包的时候要设置女仆的名称，供ui识别

√ 坐下状态
 √ 无寻路和索敌AI，不会动
 √ 坐下时清除水平速度（清除了仍然会动，不是惯性导致的）
 √ 攻击模式下会暂停索敌并去除玩家标识
 √ 农业模式下会暂停扫描
 √ 不会传送回家

修改阵亡或收回时的处理
√ 阵亡时产生墓碑
收回时直接爆出物品

记录点
 - 将原属于背包的换包等交互挪至女仆

掉落箱子在多人游戏很麻烦，需要改进
农场模式添加地狱疣
农田模式补种时先判断四周的作物种类
尝试为女仆近战攻击设置倍数

*收回女仆时保留背包信息，原地落下的包只是一个拥有最大背包存储容量的箱子，不会掉落背包物品；
*女仆阵亡时生成坟墓，而不是箱子

适配动画
 - 初步探索，修改动画，用爱丽丝的模型试验（进行中）
class GeckoModelLoader 载入动画文件，只是载入，动画的内部结构没有变

定位组
armLeftPositioningBone  左手物品的位置，其父组必须是 armLeft
armRightPositioningBone  右手物品的位置，其父组必须是 armRight
☆ backpackPositioningBone  背包肩带位置，它必须位于根目录下

blockbench插件
动画文件的骨骼命名是 LeftLeg 这种
模型文件的则是 armRight

在动画解析过程中，一个或多个bone对应一个name，name的作用是
- 妖精女仆被苦力怕炸死时掉落妖精女仆头颅
- 手办底座  需要修改模型，待动画适配完成后添加
- 手办/雕塑的转向动画无法取消，适配动画后可以利用root骨骼进行旋转
- 适配语音包
- 庭灯：可以存储P点、为附近的女仆提供buff，打掉之后P点会以lore的形式存储在物品之中（需要测试lore中是否能包含translate文本）

- 花草模式
- 清雪模式
- 繁殖动物模式
  每隔一段时间，检查女仆是否有目标，若无，则扫描附近区域，查看是否有可配对的动物，将定位点设在动物附近
  定位点与动物绑定，自生成后便跟随动物运动，当目标动物死亡，定位点被释放，当存在时间过长，定位点也被释放。
  定位点被女仆攻击时，触发寻路成功事件，使目标动物进入繁殖状态，同时搜索附近已进入繁殖状态的动物，在二者之间生成baby，并使父母进入冷却状态。
- *养蜂模式：根据背包内物品，自动收获自然和人工蜂巢
- *综合农业模式：所有农业模式的合体（高等级开放）
- *综合牧业模式：所有牧业模式的合体（高等级开放）
- 饰品
- 优化弹幕瞄准方向，取目标位置与目标头部连线的中点（若有头）

*回血数字
*女仆背包内物品进入箱子的方式。九宫格存在绑定问题，不太好实现；隙间容易做，但是需要增加饰品功能。
*相册（lore的上限是64行，目前一张照片有2行，如果女仆名字长一些则会更多。容量设计为16）
*黄金微波炉的音效
*弹幕的架构设计存在缺陷，不能很好地同时处理默认弹幕与自定义弹幕。考虑为 默认弹幕 和 自定义弹幕 的实体专门建类，发射时根据类型用它们来构造实体，然后用相同的方法发射。
*恶魂无法成为攻击目标？
*御币改为长按连发
*新版本中手上没有物品则不会触发beforeItemUseOn事件，导致空手取下祭坛上的物品失效，需要另寻它法。目前不是很急，因为可以跳起来取。
*适配光追
*为主面板增加按键弹出式UI，展示工作模式的介绍
测试版api的spawnentity给了option，可能可以解决手办转向动画和缩放设置的问题
------------------

长期计划
*（特色）好感度。到达一定值可以解锁cosplay服装、专属武器合成配方、支援弹幕（类似地灵殿，会自动攻击玩家攻击的实体）。互动、赠送礼物可以升高，均有冷却时间；战死、过度工作则会降低。
*（特色）学习。学习可以获得经验值，提高等级从而做更多事情，掌握更多技能（如解锁弹幕攻击方式）
*（特色）幻翼鲨手模式：大功率发射只伤害幻翼的弹幕
增加技能系统，女仆可以习得多种技能并装备其中的有限个，攻击时能积累技能点，达到需求即可释放技能。
  可以自动释放，也可以由玩家使用远程法杖手动释放
  技能分 攻击、防御、辅助等，各种类型的技能有装备上限和使用冷却
    攻击：使用特殊的攻击模式对目标发起攻击（如特殊弹幕）
    防御：加强对物理或魔法攻击的减免（技能防御不能完全减免）
    辅助：加强物理或魔法攻击的伤害、提高移速、隐身等

模式选择图标：
+    空闲        羽毛    items/feather.png
+    近战攻击    钻石剑  items/diamond_sword.png
+    弓兵        弓      items/bow_standby.png
+    弹幕攻击    御币     items/hakurei_gohei.png
+    农场        铁锄    items/iron_hoe.png
+    幻翼杀手    幻翼膜   items/phantom_membrane.png
*    甘蔗        甘蔗     items/reeds.png
*    瓜类        西瓜片   items/melon.png
*    可可        可可豆   items/dye_powder_brown.png

*    花草        单层草   items/tallgrass.png
*    清雪        雪球     items/snowball.png
*    喂食        熟牛排   items/beef_cooked.png
*    剪刀        剪刀     items/shears.png
*    牛奶        牛奶     items/bucket_milk.png
*    火把        火把     items/torch_on.png
*    繁殖动物    小麦     items/wheat.png
*    灭火        灭火器   items/extinguisher.png
*    钓鱼        鱼竿

得研究一下子包怎么做，还有脚本能不能共用，以提高可拓展。

-----

【弹幕系统】
（待完善）修改符札弹渲染方案，角度朝向运动方向，自转跟随加速度方向
（待完善）弹幕的inaccuracy与java保持一致
（待完善）妖精女仆发射弹幕时播放雪球声音
（待完善）用mark_variant或直接播放缩放动画来设置缩放倍率scale。()
（待加入）冲击炸弹 冲击效果非常强，伤害一般
（待加入）判定点。受击时计算与玩家的距离，在范围内才触发伤害。潜行时显示虚化身体骨骼并显示判定点（可选，因为可能与别的addon不兼容）。
（待加入）参考凋灵风暴制作魔炮,外层混合内层发光。
（待加入）实体不会被同组弹幕击伤。弹幕编组tag前缀：tdg，如tdgxxx （touhou danmaku group）。为提高性能，弹幕自身和玩家的编组靠动态属性标记。
    受击判定时，若找不到发射实体，则查看弹幕是否被标记。不过目前还没有无发射者的弹幕，估以后也不会有。
（待加入）八卦炉：长按即可发射，不同发射模式有不同的发射时长上限和冷却时间（PS 消耗耐久然后自动回复也行，更像能量消耗），一旦发射能量耗尽就会进入对应的冷却阶段。发射模式：低火力星弹、高火力星弹、激光、魔炮；在扫帚上使用能加速。
（待完善）试验伤害（damage）是否能为小数，若是，则更新entitydanmaku和danmakushoot的setDamage参数为Float


（待加入）basic弹幕：激光。利用scale随时间变化达到无限长度射击的效果，击中目标后，激光会停止拉长并立即消失。或许可以射出实际的、透明的战斗部，然后用粒子效果展现激光。
（待加入）Advanced弹幕：达到某一条件（如速度、位置、触地、击中）后就触发事件的弹幕。  发射一枚斜向上的弹幕，
（待加入）自定义弹幕：命名时用“custom”和原先的basic组分开。
（待加入）Advanced弹幕：编组弹幕。在生成后会召唤出基础弹幕，随后操控它们的运动状态。如灵乌路空的原子模型
（待加入）Advanced弹幕：阴阳玉。触地反弹。
（待加入）Advanced弹幕：追踪符札：[ 纸×3 + 火药 + 炸药/药水/纸 ] 在祭坛消耗0.5P点合成 [ 符札×8 ]。符札会自动追踪发射时瞄准的实体，若发射时视线上没有实体，则获取一定范围内的所有生物，计算它到视线（一根线段）的距离，符合条件则寻找折线路径；若没有找到，则自行寻找运行方向上最近的敌对生物；基础伤害等于力量4的弓射出的箭，第三项合成材料为药水时会附带对应的药水效果，时长同药水箭，为炸药时造成范围伤害，为纸时仅造成基础单体伤害。
（待加入）魔炮：激活后立即让玩家骑上一个技术性实体，玩家可以通过视角变换来调整发射方向，方向键调整自己和发射点位置，蓄力时可以以较快的速度改变角度和发射点，而开始轰击后就只能以非常缓慢的速度调整了


（待加入）冈格尼尔：高级三叉戟。
（待加入）支持多种欧拉角旋转次序
（待完善）加入可设置的重力：因为不能动态设置重力，采用跃迁式的设置方式，0-1，每0.1设一段，向上取整地设置重力
（待完善）可设置的变向变力：提供两个函数接口： 方向随时间变化的函数 和 大小随时间变化的函数。为性能考虑，在生成该类弹幕后会保留对其的引用，每游戏刻主动修改其动量。
（待完善）可设置的运动轨迹：提供一个函数接口： 弹幕位置随时间变化的函数。 为性能考虑，在生成该类弹幕后会保留对其的引用，每游戏刻主动修改其动量。
    计算方法是先算出下一游戏刻应该处于的位置，然后计算要到达该位置应有的动量，最后将动量设置为应有的动量。设置有两种方法，一种是清空直接设置，另一种是在原有基础上叠加，需要测试二者的性能谁更强。
PS：变向变力与运动轨迹均可以选择世界坐标和相对坐标。
*（待完善）各弹种的判定范围（可能无法实现）
PS：角色的特色武器可以设定为无法合成，只能在对应女仆好感度达到一定等级时获取。
PS：大多数stg符卡都较难作为玩家发射的弹幕，因为指向性不强，效果可能不如被怪物释放
用q.get_name制作命名彩蛋

（无法完善）给御币加上使用周期，从而取消食物动画。虽然食物动画取消了，但手部动画也没了，其它玩家看不出是不是在蓄力，要增加动画的判定则要修改player相关的文件，会降低兼容性。


-----
【boss生物】
~~计划利用末影龙变体和附着物实现无限距离加载~~
切赛德
魔理沙（符卡还原相对简单）
藤原妹红（时间陷阱可用）

模仿植物魔法boss，搭建场地才能召唤，且有冷却时间。
boss只会受到来自女仆的攻击，并且只会攻击女仆。玩家可以在场内通过远程法杖指挥女仆走位和攻击。
限制场内的女仆数量，超限的女仆会被变成物品。

-----

【其它】

*（未使用）闪烁贴图：见danmaku_basic render的注释部分
* 扫帚，玩家坐上去之后视角向上按前进就可以飞，参考minecar的飞行矿车。
坐垫功能化
  使用村民交易制作每天刷新新交易的电脑，电脑可以购买其它功能物品
数字显示参考 https://mcpedl.com/damage-count/
* 通过修改下拉列表实现无停顿的操作。玩家点击按钮只是选择了某个选项，最终关闭表单时选择才会生效。
凑齐多种皮肤差分，制作geometry视频
