

------------------

#### 大批量数据传输方案

要提供外部配置方法，不然每次更新都要改配置，很麻烦
考虑预留一个函数，让外部行为包定义它，调用scriptevent传值，每次世界加载时自动调用。
每个信息的最大长度为2048，所以有些信息可能要分多次发送，于是定义每条信息如下：
    信息组ID:总条数:当前条:内容（字符串）
    如："1:5:0:string_message"
    脚本会接收指定事件，在接收到了某组信息的全部信息时，将它们组装起来供其它模块使用。

------------------

#### 交互设计

  右击：坐
  左击：打开菜单
  潜行右击：打开背包
  潜行手持背包右击：切换背包

------------------

#### 关于背包

  因为女仆的物品栏还要用作种植、装护甲，物品不能总是放实体背包，实体背包只是供玩家交互的。
  利用只有潜行才能与背包交互的特性，进入潜行时，将女仆包内的物品剪切进背包，护甲、饰品及手上的物品复制进背包
  退出潜行时，背包物品放回女仆背包，装备则更新信息

------------------

#### 表情显示

展示不同的表情不难，用一个int属性即可。
但是若要设置动态表情的播放速度就需要特别设计一下了。用脚本自然是很方便的，但是会占用宝贵的属性条目，需要尝试使用 variable 等资源包手段控制。
考虑对特殊处理，然后取模得到动画速率。
属性值的取值范围是 -2147483648, 214 748 3647，正好可以让正数作为表情索引，负数作为速率！
至于贴图动画的偏移量，用基于贴图大小的操作：
    "offset": [
        0.0,
        "math.mod(math.floor(query.life_time * 0.5),4) / 4"
    ],
    "scale": [
        1.0,
        "1 / 4"
    ]
序列帧的数量又需要传递了... 很想再加个取模传值的操作。
就用取模。所谓“速率”实际上是指多少游戏刻一帧，这个值不太可能超过999，超过了就和静态的差不多了，如法炮制，无需多次传值，只要将三个数合并到一个数里即可。
2147483647 是十位数，大端满不了9需要注意，按速率，帧数，序号的顺序分配：
2 147 483 647
三个数各1k，非常够用了。
比如3号表情有5个序列帧，速率为10，则表示为 10,005,003
emote_index  emote_frame  emote_speed

------------------

#### 关节朝向实体运动方向

原版箭朝向运动方向是硬编码，且无法通过 runtime identifier 添加。

*资源包实现
只需要对欧拉角 z x 旋转，即可得到任何想要的方向。
为了表示方便，设运动方向为(x,y,z)
为了计算方便，设骨骼初始朝向为(1,0,0)
先算出 y-x 平面上旋转的角度，即 z 值，再算出 x 值
下面是将x值近似为x-z平面旋转角度的资源包实现，实际测试中骨骼并没有旋转，可能是movement_direction的获取出了问题。文档中注明这个值与鞘翅有关，猜测是只有鞘翅能获取这个值。
"rotation": ["(180/3.14)*math.atan2(query.movement_direction(2), query.movement_direction(0))", 0, "(180/3.14)*math.atan2(query.movement_direction(1), query.movement_direction(0))"]

*行为包实现
可以添加 thlm:r_x/z 属性，直接设置旋转量。

------------------

#### 穿透射击

实体受击事件是串行处理的，只穿透实体问题不大
但是既穿方块又穿实体就会出现问题。方块的击中事件是在实体之后处理的，弹速很快时就会无视方块数量造成伤害。
并且击中方块事件能检测到的方块并不是所有被穿透的方块，这意味着弹幕在穿过一段距离之内的所有方块后才会将穿透计数器减一
如此，我们只能在发射前就检测路径上的实体与方块，计算实体是否能被击中。
