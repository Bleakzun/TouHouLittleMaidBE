import*as t from"@minecraft/server";import*as e from"@minecraft/server-ui";var a={d:(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const i=(o={BlockPermutation:()=>t.BlockPermutation,BlockVolume:()=>t.BlockVolume,Direction:()=>t.Direction,EnchantmentTypes:()=>t.EnchantmentTypes,EntityDamageCause:()=>t.EntityDamageCause,EquipmentSlot:()=>t.EquipmentSlot,GameMode:()=>t.GameMode,ItemStack:()=>t.ItemStack,system:()=>t.system,world:()=>t.world},r={},a.d(r,o),r);var o,r;class n{constructor(t,e,a){this.size=t,this.background=e,this.blocks=a}activate(t,e,a=[0,1,2,3]){let o=this.isStructrueUnbroken(t,e,a,"deactivated");if(-1==o)return-1;for(let a of this.blocks){let r=this.rotateCoordinate(a.location,o);const n=t.getBlock({x:e[0]+r[0],y:e[1]+r[1],z:e[2]+r[2]});if(null==a.activated)n.setType("air");else if(null==a.activated.data)n.setPermutation(i.BlockPermutation.resolve(a.activated.name));else{let t={};for(let e in a.activated.data)"r"===a.activated.data[e]?t[e]=o+1:t[e]=a.activated.data[e];n.setPermutation(i.BlockPermutation.resolve(a.activated.name,t))}}return o}deactivate(t,e,a){if(-1!=this.isStructrueUnbroken(t,e,[a],"activated",!1))return!1;for(let o of this.blocks){let r=this.rotateCoordinate(o.location,a);const n=t.getBlock({x:e[0]+r[0],y:e[1]+r[1],z:e[2]+r[2]});if(null==o.activated||this.isBlockInStructrue(n,o.activated))if(null==o.deactivated)n.setType("air");else if(null==o.deactivated.data)n.setPermutation(i.BlockPermutation.resolve(o.deactivated.name));else{let t={};for(let e in o.deactivated.data)t[e]=o.deactivated.data[e];n.setPermutation(i.BlockPermutation.resolve(o.deactivated.name,t))}}return!0}isStructrueUnbroken(t,e,a=[0,1,2,3],i="deactivated",o=!0){for(let r of a)if(!(r<0||r>3))if(o){let a=[];for(let t=0;t<this.size[0];t++){a[t]=[];for(let e=0;e<this.size[1];e++){a[t][e]=[];for(let i=0;i<this.size[2];i++)a[t][e][i]=-1}}for(let t=0;t<this.blocks.length;t++){let e=this.rotateCoordinate(this.blocks[t].location,r);a[e[0]][e[1]][e[2]]=t}let o=!1;for(let r=0;r<a.length;r++){for(let n=0;n<a[r].length;n++){for(let s=0;s<a[r][n].length;s++){const l=t.getBlock({x:e[0]+r,y:e[1]+n,z:e[2]+s});if(-1===a[r][n][s]){if(!this.isBackground(l)){o=!0;break}}else if(!this.isBlockInStructrue(l,this.blocks[a[r][n][s]][i])){o=!0;break}}if(1==o)break}if(1==o)break}if(!o)return r}else{let a=!1;for(let o of this.blocks){let n=this.getPointByBaseLocation(o.location,e,r);if(null!=o[i]&&!this.isBlockInStructrue(t.getBlock({x:n[0],y:n[1],z:n[2]}),o[i])){a=!0;break}}if(!a)return r}return-1}isBackground(t){if(void 0!==this.background&&this.background!=[]){for(let e of this.background)if(t.typeId==e.name){let a=!0;for(let i in e.data)if(t.permutation.getState(i)!=e.data[i]){a=!1;break}if(a)return!0}return!1}return!0}isBlockInStructrue(t,e){if(t.typeId!=e.name)return e.name,t.typeId,!1;{let a=!0;if(null!=e.data)for(let a in e.data){let i=e.data[a];if("r"!==i&&t.permutation.getState(a)!=i)return t.permutation.getState(a),!1}if(a)return!0}}rotateCoordinate(t,e=0){switch(e){case 0:default:return t;case 1:return[this.size[0]-1-t[2],t[1],t[0]];case 2:return[this.size[0]-1-t[0],t[1],this.size[2]-1-t[2]];case 3:return[t[2],t[1],this.size[2]-1-t[0]]}}getBaseLocationByPoint(t,e,a=0){switch(a){default:return[e[0]-t[0],e[1]-t[1],e[2]-t[2]];case 1:return[e[0]-this.size[0]+1+t[2],e[1]-t[1],e[2]-t[0]];case 2:return[e[0]-this.size[0]+1+t[0],e[1]-t[1],e[2]-this.size[2]+1+t[2]];case 3:return[e[0]-t[2],e[1]-t[1],e[2]-this.size[2]+1+t[0]]}}getPointByBaseLocation(t,e,a=0){switch(a){default:return[e[0]+t[0],e[1]+t[1],e[2]+t[2]];case 1:return[e[0]+this.size[0]-1-t[2],e[1]+t[1],e[2]+t[0]];case 2:return[e[0]+this.size[0]-1-t[0],e[1]+t[1],e[2]+this.size[2]-1-t[2]];case 3:return[e[0]+t[2],e[1]+t[1],e[2]+this.size[2]-1-t[0]]}}}var s={maid_death_bag:!1,ui_enable:1,fairy_damage:100,maid_damage:100,danmaku_damage:6,player_damage:100,logger_enable:0,glyph:229};class l{static name="thlmconfig";static init(){var t=i.world.scoreboard.getObjective(this.name);if(void 0===t)i.world.getDimension("overworld").runCommand(`scoreboard objectives add ${this.name} dummy ${this.name}`),i.system.runTimeout((()=>{this.setScoreboard()}),1);else{let e=t.getScores();for(let t of e){let e=t.participant.displayName;switch(typeof s[e]){case"boolean":s[e]=1===t.score;break;case"number":s[e]=t.score}}}}static setScoreboard(){var t=i.world.scoreboard.getObjective(this.name);let e=0;for(let a in s)e<1?e++:"boolean"==typeof s[a]?t.setScore(a,s[a]?1:0):t.setScore(a,s[a])}static set(t,e){i.world.scoreboard.getObjective(this.name).setScore(t,e),"boolean"==typeof s[t]?s[t]=1===e:s[t]=e}static tostring(){let t=0,e="";for(let a in s)t<1?t++:"boolean"==typeof s[a]?e+=` ${a} - ${s[a]?"true":"false"}\n`:e+=` ${a} - ${s[a]}\n`;return e}}function c(t){if(1==s.logger_enable)for(let e of i.world.getPlayers())e.sendMessage({rawtext:[{text:`${t}`}]})}function m(t=0,e=1){return t<e?t+Math.random()*(e-t):null}function d(t=0,e=1){return t+Math.floor(Math.random()*(e+1))}function u(t){return t*(Math.PI/180)}function h(t,e,a,i,o,r,n,s,l){if(i<n){if(t<i||n<t)return!1}else if(t<n||i<t)return!1;if(o<s){if(e<o||s<e)return!1}else if(e<s||o<e)return!1;if(r<l){if(a<r||l<a)return!1}else if(a<l||r<a)return!1;return!0}class g{static setPlayerMainHand(t,e=void 0){let a=t.getComponent("inventory").container,i=t.selectedSlotIndex;void 0===e?a.setItem(i):a.setItem(i,e)}static getPlayerMainHand(t){let e=t.getComponent("inventory").container,a=t.selectedSlotIndex;return e.getItem(a)}static decrementMainHandStack(t,e=1){let a=t.getComponent("inventory").container,i=t.selectedSlotIndex,o=a.getItem(i);o=o.amount-e<=0?void 0:(o.amount-=e,o),a.setItem(i,o)}static damageMainHandStack(t){let e=t.getComponent("minecraft:equippable"),a=e.getEquipment(i.EquipmentSlot.Mainhand),o=0,r=a.getComponent("enchantable");if(void 0!==r){let t=r.getEnchantment("unbreaking");void 0!==t&&(o=t.level)}if(0===o||0===d(0,o.level)){let t=a.getComponent("durability").damage+1;t>=a.getComponent("durability").maxDurability?e.setEquipment(i.EquipmentSlot.Mainhand):(a.getComponent("durability").damage=t,e.setEquipment(i.EquipmentSlot.Mainhand,a))}}}class f{static runCommand(t,e){const a=t.location;t.dimension.runCommand(`execute positioned ${a.x} ${a.y} ${a.z} run ${e}`)}}function p(t){switch(t){case 0:return"minecraft:overworld";case 1:return"minecraft:nether";case 2:return"minecraft:the_end";default:return}}function _(t){let e=function(t){let e="";for(let a=0;a<t.length;a++)e+="§"+t[a];return e}(t),a=[];for(;;){if(!(e.length>50)){a.push(e);break}a.push(e.slice(0,50)),e=e.slice(50)}return a}function y(t){let e="";for(let a of t)e+=a;let a="";for(let t=1;t<e.length;t+=2)a+=e[t];return a}function k(t){return-1!=t.indexOf(" ")?'"'+t+'"':t}function w(t,e){i.world.getDimension("overworld").runCommand(`titleraw ${k(t)} actionbar {"rawtext":[{"translate":"${e}"}]}`)}class v{static translate(t,e){t.dimension.runCommand(`titleraw ${k(t.name)} actionbar {"rawtext":[{"translate":"${e}"}]}`)}static text(t,e){t.runCommand(`titleraw @s actionbar {"rawtext":[{"text":"${e}"}]}`)}static text(t,e){t.dimension.runCommand(`titleraw ${k(name)} actionbar ${JSON.stringify(e)}`)}}class b{x;y;z;constructor(t,e,a){return{x:t,y:e,z:a}}}class x{static length(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}static normalized(t){let e=this.length(t);return e<1e-8?new b(0,0,0):new b(t.x/e,t.y/e,t.z/e)}static add(t,e){return new b(t.x+e.x,t.y+e.y,t.z+e.z)}static sub(t,e){return new b(t.x-e.x,t.y-e.y,t.z-e.z)}static multiply(t,e){return new b(t.x*e,t.y*e,t.z*e)}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){return new b(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}static rotate_axis(t,e,a){let i=this.normalized(e),o=Math.cos(a),r=Math.sin(a);return this.add(this.add(this.multiply(t,o),this.multiply(this.cross(i,t),r)),this.multiply(this.multiply(i,this.dot(i,t)),1-o))}static toString(t){return`x:${t.x.toFixed(2)},y:${t.y.toFixed(2)},z:${t.z.toFixed(2)}`}static getVector_speed_direction(t,e){let a=Math.sqrt(t*t/(e.x*e.x+e.y*e.y+e.z*e.z));return new b(e.x*a,e.y*a,e.z*a)}static getEulerAngle(t){let e=Math.atan2(t.x,t.y),a=Math.acos(Math.sqrt(t.x*t.x+t.y*t.y)/this.length(t));return t.z<0&&(a*=-1),[a,e]}static getAnyVerticalVector(t){if(0==t.x&&0==t.y){if(0==t.z)return;return new b(1,0,0)}return 0==t.y?new b(0,1,0):new b(1,-t.x/t.y,0)}static getDirectionByView2D(t){let e=Math.abs(t.x)-Math.abs(t.y)>0;return t.x>0?t.z>0?e?i.Direction.East:i.Direction.South:e?i.Direction.East:i.Direction.North:t.z>0?e?i.Direction.West:i.Direction.South:e?i.Direction.West:i.Direction.North}static preJudge(t,e,a,i){let o=this.sub(t,e),r=this.normalized(o),n=this.dot(i,r),s=this.multiply(r,n),l=this.sub(i,s),c=a*a-(l.x*l.x+l.y*l.y+l.z*l.z);if(c<=0)return l;let m=Math.sqrt(c),d=this.multiply(this.multiply(r,-1),m);return this.add(l,d)}}const I={spawn_lightning_bolt:{type:"touhou_little_maid:altar_crafting",output:{type:"minecraft:lightning_bolt"},power:.2,ingredients:[{tag:"forge:gunpowder"},{tag:"forge:gunpowder"},{tag:"forge:gunpowder"},{item:"minecraft:blaze_powder"},{item:"minecraft:blaze_powder"},{item:"minecraft:blaze_powder"}]},craft_hakurei_gohei:{type:"touhou_little_maid:altar_crafting",output:{type:"minecraft:item",nbt:{Item:{id:"touhou_little_maid:hakurei_gohei_pellet",Count:1,Enchantments:{infinity:1},tag:{Damage:0}}}},power:.15,ingredients:[{tag:"forge:rods/wooden"},{item:"minecraft:paper"},{tag:"forge:rods/wooden"},{item:"minecraft:paper"},{tag:"forge:rods/wooden"},{item:"minecraft:paper"}]},repair_hakurei_gohei:{type:"touhou_little_maid:altar_crafting",output:{type:"thlm:repair",item:{target:{tag:"thlm:gohei"},amount:300}},power:.1,ingredients:[{tag:"thlm:gohei"},{item:"minecraft:paper"},{item:"minecraft:paper"}]},gohei_cherry:{type:"touhou_little_maid:altar_crafting",output:{type:"minecraft:item",nbt:{Item:{id:"touhou_little_maid:hakurei_gohei_cherry",Count:1,tag:{Damage:0}}}},power:2,ingredients:[{tag:"thlm:gohei_lv1"},{item:"minecraft:cherry_sapling"},{item:"minecraft:water_bucket"},{item:"minecraft:water_bucket"},{item:"minecraft:dirt"}]},spawn_box:{type:"touhou_little_maid:altar_crafting",output:{type:"touhou_little_maid:box",nbt:{Passengers:[{id:"touhou_little_maid:maid"}]}},power:.5,ingredients:[{item:"minecraft:diamond"},{item:"minecraft:lapis_block"},{item:"minecraft:gold_block"},{item:"minecraft:redstone_block"},{item:"minecraft:iron_block"},{item:"minecraft:coal_block"}]},maid_upgrade:{type:"touhou_little_maid:altar_crafting",output:{type:"touhou_little_maid:maid_upgrade",kills:200,level:2},power:.5,ingredients:[{item:"touhou_little_maid:hakurei_gohei_cherry"},{item:"touhou_little_maid:magic_powder"}]},reborn_maid:{type:"touhou_little_maid:altar_crafting",output:{type:"touhou_little_maid:maid",nbt:{},copy:{ingredient:{item:"touhou_little_maid:film"},tag:"MaidInfo"}},power:.5,ingredients:[{item:"touhou_little_maid:film"},{item:"minecraft:lapis_lazuli"},{item:"minecraft:gold_ingot"},{item:"minecraft:redstone"},{item:"minecraft:iron_ingot"},{item:"minecraft:coal"}]},craft_camera:{type:"touhou_little_maid:altar_crafting",output:{type:"minecraft:item",nbt:{Item:{id:"touhou_little_maid:camera",Count:1,tag:{Damage:0}}}},power:.2,ingredients:[{item:"minecraft:quartz_block"},{item:"minecraft:quartz_block"},{item:"minecraft:quartz_block"},{item:"minecraft:quartz_block"},{item:"minecraft:obsidian"},{item:"minecraft:obsidian"}]},craft_maid_backpack_small:{type:"touhou_little_maid:altar_crafting",output:{type:"minecraft:item",nbt:{Item:{id:"touhou_little_maid:maid_backpack_small",Count:1}}},power:.1,ingredients:[{item:"minecraft:red_wool"},{item:"minecraft:red_wool"},{item:"minecraft:red_wool"},{item:"minecraft:red_wool"},{item:"minecraft:iron_ingot"},{item:"minecraft:red_wool"}]},craft_maid_backpack_middle:{type:"touhou_little_maid:altar_crafting",output:{type:"minecraft:item",nbt:{Item:{id:"touhou_little_maid:maid_backpack_middle",Count:1}}},power:.2,ingredients:[{item:"minecraft:pink_wool"},{item:"minecraft:pink_wool"},{item:"minecraft:pink_wool"},{item:"minecraft:pink_wool"},{item:"minecraft:gold_ingot"},{item:"minecraft:pink_wool"}]},craft_maid_backpack_big:{type:"touhou_little_maid:altar_crafting",output:{type:"minecraft:item",nbt:{Item:{id:"touhou_little_maid:maid_backpack_big",Count:1}}},power:.3,ingredients:[{item:"minecraft:gray_wool"},{item:"minecraft:gray_wool"},{item:"minecraft:gray_wool"},{item:"minecraft:gray_wool"},{item:"minecraft:diamond"},{item:"minecraft:gray_wool"}]},craft_chisel:{type:"touhou_little_maid:altar_crafting",output:{type:"minecraft:item",nbt:{Item:{id:"touhou_little_maid:chisel",Count:1,tag:{Damage:0}}}},power:.2,ingredients:[{tag:"forge:rods/wooden"},{tag:"forge:rods/wooden"},{item:"minecraft:iron_ingot"},{item:"minecraft:iron_ingot"},{item:"minecraft:yellow_dye"},{item:"minecraft:red_dye"}]}},S={"forge:gunpowder":[{item:"minecraft:gunpowder"}],"forge:rods/wooden":[{item:"minecraft:stick"}],"thlm:gohei_lv1":[{item:"touhou_little_maid:hakurei_gohei_pellet"},{item:"touhou_little_maid:hakurei_gohei_orbs"},{item:"touhou_little_maid:hakurei_gohei_ball"},{item:"touhou_little_maid:hakurei_gohei_big_ball"},{item:"touhou_little_maid:hakurei_gohei_bubble"},{item:"touhou_little_maid:hakurei_gohei_heart"},{item:"touhou_little_maid:hakurei_gohei_amulet"},{item:"touhou_little_maid:hakurei_gohei_star"},{item:"touhou_little_maid:hakurei_gohei_big_star"},{item:"touhou_little_maid:hakurei_gohei_glowey_ball"}],"thlm:gohei":[{tag:"thlm:gohei_lv1"},{item:"touhou_little_maid:hakurei_gohei_cherry"}]};class E{static registerCC(t){t.itemComponentRegistry.registerCustomComponent("tlm:power_point",{onUse(t){let e=t.source;g.decrementMainHandStack(e);let a=e.dimension.spawnEntity("touhou_little_maid:power_point",e.getHeadLocation()).getComponent("projectile");a.owner=e,a.shoot(e.getViewDirection())}})}static init(t){null==i.world.scoreboard.getObjective("p")&&i.world.getDimension("overworld").runCommand("scoreboard objectives add p dummy power")}static init_power_point(t){t.applyImpulse(this.get_velocity_power_point())}static powerpoint_hit(t,e){try{let a=t.location;"minecraft:air"!=e.getBlock(t.location).typeId&&(a=new b(t.location.x,Math.ceil(t.location.y),t.location.z)),this.summon_power_velocity(Math.ceil(m(30,90)),e,a,[t.getVelocity().x/2,0,t.getVelocity().z/2]),e.spawnParticle("touhou_little_maid:splash_power_point",a)}catch{}t.triggerEvent("despawn")}static fairy_death(t){t.dimension.spawnEntity("touhou_little_maid:p_point",t.location).triggerEvent("init_p1"),t.dimension.spawnEntity("touhou_little_maid:p_point",t.location).triggerEvent("init_p1"),t.dimension.spawnEntity("touhou_little_maid:p_point",t.location).triggerEvent("init_p3"),t.dimension.spawnEntity("touhou_little_maid:p_point",t.location).triggerEvent("init_p3")}static power_point_distance=8;static power_point_max_speed=1;static scan_power_point(t){const e=t.dimension.getEntities({type:"touhou_little_maid:p_point",maxDistance:this.power_point_distance,location:t.location});for(let a of e)try{void 0===a.getDynamicProperty("target")&&(a.triggerEvent("scan_start"),a.setDynamicProperty("target",t.id))}catch{}}static show(t){!function(t,e){i.world.getDimension("overworld").runCommand(`title ${k(t)} actionbar ${e}`)}(t.name,`§cP: ${(this.get_power_number(t)/100).toFixed(2)}`)}static scan_powerpoint(t){let e,a=t.getDynamicProperty("target");if(void 0===a){const a=t.dimension.getPlayers({closest:1});if(!(a.length>=1))return;e=a[0],t.setDynamicProperty("target",e.id)}else e=i.world.getEntity(a);if(void 0===e)t.setDynamicProperty("target",void 0);else{let a=e.getHeadLocation(),i=a.y-t.location.y,o=a.x-t.location.x,r=a.z-t.location.z,n=Math.sqrt(o*o+r*r);if(-1*this.power_point_distance<n&&n<this.power_point_distance&&-5<i&&i<6)if(-1<o&&o<1&&-1<r&&r<1&&-2<i&&i<1){let a=this.get_power_number(e),i=!1;for(let e of t.getTags())if("thlm:p"==e.substring(0,6)){a+=parseInt(e.substring(6)),i=!0;break}if(!i)switch(t.getComponent("minecraft:variant").value){case 0:a+=1;break;case 1:a+=4;break;case 2:a+=7;break;case 3:a+=10;break;case 4:a+=500}a>500&&e.runCommand(`xp ${a-500} @s`),this.set_power_number(e.name,Math.min(500,a)),e.dimension.runCommand(`playsound power_pop ${k(e.name)}`),t.triggerEvent("despawn")}else{let e=n>1?this.power_point_max_speed-n*(this.power_point_max_speed/this.power_point_distance):n*(this.power_point_max_speed/this.power_point_distance),a=e*(o/n),s=e*(r/n),l=t.getVelocity().y-.036;-1.5<o&&o<1.5&&-1.5<r&&r<1.5&&i>1&&(l=i>0?.5-.025*i:.3*i),t.clearVelocity(),t.applyImpulse(new b(a,l,s))}else t.setDynamicProperty("target",void 0)}}static test_power_number(t){let e=i.world.scoreboard.getObjective("p").getScores();for(let a of e)if(a.participant.displayName==t)return!0;return!1}static get_power_number(t){let e=i.world.scoreboard.getObjective("p").getScore(t);return void 0!==e?e:(i.world.getDimension("overworld").runCommand(`scoreboard players add ${k(t.name)} p 0`),0)}static set_power_number(t,e){i.world.getDimension("overworld").runCommand(`scoreboard players set ${k(t)} p ${e}`)}static summon_power_velocity(t,e,a,o){let r=t;for(i.world.getDimension("overworld");;){let t=e.spawnEntity("touhou_little_maid:p_point",a);if(m(),m(),t.applyImpulse(this.get_velocity_power_point(o)),r>=32?(t.triggerEvent("init_ns_p4"),t.addTag("thlm:p32"),r-=32):r>=16?(t.triggerEvent("init_ns_p4"),t.addTag("thlm:p16"),r-=16):r>=10?(t.triggerEvent("init_ns_p4"),r-=10):r>=7?(t.triggerEvent("init_ns_p3"),r-=7):r>=4?(t.triggerEvent("init_ns_p2"),r-=4):r>=0&&(t.triggerEvent("init_ns_p1"),r-=1),r<=0)return!0}return!1}static get_velocity_power_point(t=[0,0,0]){let e=m()<.5?1:-1,a=m()<.5?1:-1;return new b(t[0]+e*m(0,.4),t[1]+m(0,.8),t[2]+a*m(0,.4))}}class T{static formatOutput(t){let e=[];e.push({translate:"message.tlm.admin.item_info"}),e.push({text:"\n"}),e.push({translate:"message.tlm.admin.maid.name"}),e.push({text:`${this.Str.getMaidName(t)}\n`}),e.push({translate:"message.tlm.admin.maid.owner.name"}),e.push({text:`${this.Str.getOwnerName(t)}\n`}),e.push({translate:"message.tlm.admin.maid.owner.id"}),e.push({text:`${this.Owner.getId(t)}\n`}),e.push({translate:"message.tlm.admin.maid.level"}),e.push({text:`${this.Level.get(t)}\n`}),e.push({translate:"message.tlm.admin.maid.kill"}),e.push({text:`${this.Kill.get(t)}\n`}),e.push({translate:"message.tlm.admin.maid.health"});let a=this.Health.get(t);return e.push({text:`${a.current}/${a.max}\n`}),e.push({translate:"message.tlm.admin.maid.work"}),e.push({text:`${X.Work.getName(this.Work.get(t))}\n`}),e.push({translate:"message.tlm.admin.maid.backpack"}),e.push({text:`${this.backpackInvisibility.get(t)}\n`}),e.push({translate:"message.tlm.admin.maid.pick"}),e.push({text:`${this.Pick.get(t)}\n`}),e.push({translate:"message.tlm.admin.maid.mute"}),e.push({text:`${this.Mute.get(t)}\n`}),e}static Level={get(t){let e=D.getValue(t,"L",1);if(void 0!==e)return D.str2short(e)},set(t,e){let a=D.short2str(e);return D.setValue(t,"L",a)}};static Kill={get(t){let e=D.getValue(t,"K",2);if(void 0!==e)return D.str2int(e.slice(0,2))},set(t,e){let a=D.int2str(e);return D.setValue(t,"K",a)}};static Owner={getId(t){let e=D.getValue(t,"O",5);if(void 0!==e)return`-${D.str2ID(e)}`},setID(t,e){let a=parseInt(e.slice(1)),i=D.ID2str(a);return D.setValue(t,"O",i)}};static Health={get(t){let e=D.getValue(t,"H",4);if(void 0!==e)return{current:D.str2int(e.slice(0,2)),max:D.str2int(e.slice(2,4))}},set(t,e,a){let i=D.int2str(e)+D.int2str(a);return D.setValue(t,"H",i)}};static Skin={get(t){let e=D.getValue(t,"S",4);if(void 0!==e)return{pack:D.str2int(e.slice(0,2)),index:D.str2int(e.slice(2,4))}},set(t,e,a){let i=D.int2str(e)+D.int2str(a);return D.setValue(t,"S",i)}};static Work={get(t){let e=D.getValue(t,"W",2);if(void 0!==e)return D.str2int(e.slice(0,2))},set(t,e){let a=D.int2str(e);return D.setValue(t,"W",a)}};static backpackInvisibility={get(t){let e=D.getValue(t,"B",1);if(void 0!==e)return D.str2bool(e)},set(t,e){let a=D.bool2str(e);return D.setValue(t,"B",a)}};static backpackType={get(t){let e=D.getValue(t,"C",2);if(void 0!==e)return D.str2int(e.slice(0,2))},set(t,e){let a=D.int2str(e);return D.setValue(t,"C",a)}};static Pick={get(t){let e=D.getValue(t,"P",1);if(void 0!==e)return D.str2bool(e)},set(t,e){let a=D.bool2str(e);return D.setValue(t,"P",a)}};static Mute={get(t){let e=D.getValue(t,"M",1);if(void 0!==e)return D.str2bool(e)},set(t,e){let a=D.bool2str(e);return D.setValue(t,"M",a)}};static Str={amount:2,getOwnerName(t){return this.getValue(t,0)},setOwnerName(t,e){return this.setValue(t,0,e)},getMaidName(t){return this.getValue(t,1)},setMaidName(t,e){return this.setValue(t,1,e)},get(t){try{let e=D.getValue(t,"N",void 0);if(void 0===e)return;return JSON.parse(e)}catch{return}},set(t,e){try{return D.setValue(t,"N",JSON.stringify(e))}catch{return t}},setValue(t,e,a){let i=this.get(t);if(void 0===i){i=[];for(let t=0;t<this.amount;t++)i[t]=0}else for(let t=i.length-1;t<this.amount;t++)i[t]=0;return i[e]=void 0===a?0:a,this.set(t,i)},getValue(t,e){let a=this.get(t);if(void 0!==a){let t=a[e];return 0===t?void 0:t}}}}class D{static getValue(t,e,a){let i=t.search(e);if(-1!==i)return t.slice(i+1,void 0===a?void 0:i+1+a)}static setValue(t,e,a){let i=t.search(e);return-1===i?t+e+a:t.slice(0,i)+e+a+t.slice(i+1+a.length)}static int2str(t){let e=Math.floor(t/256),a=Math.floor(t%256);return String.fromCodePoint(40960+e)+String.fromCodePoint(40960+a)}static str2int(t){return 256*(t.charCodeAt(0)-40960)+(t.charCodeAt(1)-40960)}static short2str(t){return String.fromCodePoint(40960+t)}static str2short(t){return t.charCodeAt(0)-40960}static ID2str(t){let e=t%4096,a=Math.floor(t%16777216/4096),i=Math.floor(t%68719476736/16777216),o=Math.floor(t%281474976710656/68719476736),r=Math.floor(t/281474976710656);return String.fromCodePoint(40960+r)+String.fromCodePoint(40960+o)+String.fromCodePoint(40960+i)+String.fromCodePoint(40960+a)+String.fromCodePoint(40960+e)}static str2ID(t){return 281474976710656*(t.charCodeAt(0)-40960)+68719476736*(t.charCodeAt(1)-40960)+16777216*(t.charCodeAt(2)-40960)+4096*(t.charCodeAt(3)-40960)+(t.charCodeAt(4)-40960)}static str2bool(t){return"0"!==t}static bool2str(t){return!0===t?"1":"0"}}const P=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,[2,2,1]];class C{static DEFAULTAMOUNT=1;static PLACEHOLDER=100;static SkinList=[120];static initScoreboard(){var t=i.world.scoreboard.getObjective("thlmskin");if(null==t)i.world.getDimension("overworld").runCommand("scoreboard objectives add thlmskin dummy THLMSkin"),i.system.runTimeout((()=>{t=i.world.scoreboard.getObjective("thlmskin");for(let e=0;e<this.SkinList.length;e++)t.setScore(`${e}`,this.SkinList[e])}),1);else for(var e=0;;)try{let a=t.getScore(`${e}`);if(void 0===a)break;this.SkinList[e]=a,e++}catch{break}}static getRandom(){let t=0;for(let e of this.SkinList)t+=e;let e=d(0,t-1),a=0,i=e;for(let t of this.SkinList){if(e-=t,e<1)break;i=e,a++}return a>this.DEFAULTAMOUNT&&(a+=100),{pack:a,seq:i}}static setSkin(t){this.SkinList=[this.SkinList[0]].concat(t),i.world.getDimension("overworld").runCommand("scoreboard objectives remove thlmskin"),i.system.runTimeout((()=>{this.initScoreboard()}),2)}static register(t,e,a){for(let i of this.SkinList)return t!==i.name&&e!==i.index&&(this.SkinList.push({name:t,index:e,length:a}),!0)}static getPackDisplayName(t){return{translate:`maid_pack.${t}.name`}}static getPackDesc(t){return{translate:`maid_pack.${t}.desc`}}static getPackIcon(t){return`textures/thlm/pack_pack_${t}.png`}static getPack(t){return this.SkinList[t]}static getPack_ID(t){for(let e of this.SkinList)if(e.index===t)return e}static getSkinDisplayName(t,e){return{translate:`model.${t}.${e}.name`}}static decodeName(t){let e=t.split(".");return{pack:Number(e[1]),index:Number(e[2])}}static getAuthors(t){return{translate:`maid_pack.${t}.authors`}}static length(){return this.SkinList.length}static getSkinAmount(t){return t>this.DEFAULTAMOUNT?this.SkinList[t-100]:this.SkinList[t]}}function M(t,e){let a=e.length;for(let i of t.getTags())if(i.substring(0,a)==e)return i.substring(a)}function L(t,e,a){z(t,e),t.addTag(`${e}${a}`)}function z(t,e){let a=e.length;for(let i of t.getTags())if(i.substring(0,a)==e)return t.removeTag(i),!0;return!1}function B(t,e,a){let i=t.getDynamicProperty(e);if(void 0!==i)return i;{let i=M(t,e+":");if(void 0!==i){switch(a){case"int":i=parseInt(i);break;case"float":i=parseFloat(i);break;case"boolean":i="1"===i;break;case"vector":{let t=i.split(",");i=new b(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}}return t.setDynamicProperty(e,i),i}}}function A(t,e){return B(t,e,"string")}function O(t,e){return B(t,e,"int")}function N(t,e){return B(t,e,"boolean")}function R(t,e){return B(t,e,"vector")}function $(t,e,a,i){if(t.setDynamicProperty(e,a),void 0===a)z(t,e+":");else{let o;switch(i){case"int":o=a.toString();break;case"float":o=a.toFixed(5);break;case"boolean":o=a?"1":"0";break;case"vector":o=`${a.x.toFixed(4)},${a.y.toFixed(4)},${a.z.toFixed(4)}`;break;default:o=a}L(t,e+":",o)}}function V(t,e,a){$(t,e,a,"string")}function W(t,e,a){$(t,e,a,"int")}function H(t,e,a){$(t,e,a,"boolean")}function G(t,e,a){$(t,e,a,"vector")}var U=[{tester:"minecraft:carrot",crops:{"minecraft:carrots":{state:{growth:7},seed:"minecraft:carrot"},"minecraft:wheat":{state:{growth:7},seed:"minecraft:wheat_seeds"},"minecraft:beetroot":{state:{growth:7},seed:"minecraft:beetroot_seeds"},"minecraft:potatoes":{state:{growth:7},seed:"minecraft:potato"},"minecraft:nether_wart":{state:{age:3},seed:"minecraft:nether_wart"},"minecraft:torchflower":{state:void 0,seed:"minecraft:torchflower_seeds"},"minecraft:pitcher_crop":{state:{upper_block_bit:!1,growth:4},seed:"minecraft:pitcher_pod"}},seeds:{"minecraft:carrot":[{block:"minecraft:carrots",state:{growth:0},land:["minecraft:farmland"]}],"minecraft:wheat_seeds":[{block:"minecraft:wheat",state:{growth:0},land:["minecraft:farmland"]}],"minecraft:beetroot_seeds":[{block:"minecraft:beetroot",state:{growth:0},land:["minecraft:farmland"]}],"minecraft:potato":[{block:"minecraft:potatoes",state:{growth:0},land:["minecraft:farmland"]}],"minecraft:nether_wart":[{block:"minecraft:nether_wart",state:{age:0},land:["minecraft:soul_sand"]}],"minecraft:torchflower_seeds":[{block:"minecraft:torchflower_crop",state:{growth:0},land:["minecraft:farmland"]}],"minecraft:pitcher_pod":[{block:"minecraft:pitcher_crop",state:{upper_block_bit:!1,growth:0},land:["minecraft:farmland"]}]}},{tester:"farmersdelight:tomato_seeds",crops:{"farmersdelight:tomato_block":{state:{"farmersdelight:growth":7},seed:"farmersdelight:tomato_seeds",keep:{block:"farmersdelight:tomato_block",state:{"farmersdelight:growth":4},loot:"farmersdelight/crops/farmersdelight_tomato_riped"}},"farmersdelight:onion_block":{state:{"farmersdelight:growth":3},seed:"farmersdelight:onion",keep:{block:"farmersdelight:onion_block",state:{"farmersdelight:growth":0},loot:"farmersdelight/crops/farmersdelight_onion_riped"}},"farmersdelight:cabbage_block":{state:{"farmersdelight:growth":7},seed:"farmersdelight:cabbage_seeds",keep:{block:"farmersdelight:cabbage_block",state:{"farmersdelight:growth":0},loot:"farmersdelight/crops/farmersdelight_cabbage_riped"}},"farmersdelight:rice_block_upper":{state:{"farmersdelight:growth":3},seed:"farmersdelight:rice",keep:{block:"farmersdelight:rice_block_upper",state:{"farmersdelight:growth":0},loot:"farmersdelight/crops/farmersdelight_rice_riped"}},"farmersdelight:rich_soil_carrot":{state:{"farmersdelight:growth":7},seed:"minecraft:carrot"},"farmersdelight:rich_soil_wheat":{state:{"farmersdelight:growth":7},seed:"minecraft:wheat_seeds"},"farmersdelight:rich_soil_beetroot":{state:{"farmersdelight:growth":7},seed:"minecraft:beetroot_seeds"},"farmersdelight:rich_soil_potato":{state:{"farmersdelight:growth":7},seed:"minecraft:potato"},"farmersdelight:rich_soil_torchflower":{state:void 0,seed:"minecraft:torchflower_seeds"}},seeds:{"farmersdelight:tomato_seeds":[{block:"farmersdelight:tomato_block",state:{"farmersdelight:growth":0},land:["minecraft:farmland","farmersdelight:rich_soil_farmland"]}],"farmersdelight:onion":[{block:"farmersdelight:onion_block",state:{"farmersdelight:growth":0},land:["minecraft:farmland","farmersdelight:rich_soil_farmland"]}],"farmersdelight:cabbage_seeds":[{block:"farmersdelight:cabbage_block",state:{"farmersdelight:growth":0},land:["minecraft:farmland","farmersdelight:rich_soil_farmland"]}],"minecraft:carrot":[{block:"farmersdelight:rich_soil_carrot",state:{"farmersdelight:growth":0},land:["farmersdelight:rich_soil_farmland"]}],"minecraft:potato":[{block:"farmersdelight:rich_soil_potato",state:{"farmersdelight:growth":0},land:["farmersdelight:rich_soil_farmland"]}],"minecraft:wheat_seeds":[{block:"farmersdelight:rich_soil_wheat",state:{"farmersdelight:growth":0},land:["farmersdelight:rich_soil_farmland"]}],"minecraft:beetroot_seeds":[{block:"farmersdelight:rich_soil_beetroot",state:{"farmersdelight:growth":0},land:["farmersdelight:rich_soil_farmland"]}],"minecraft:torchflower_seeds":[{block:"farmersdelight:rich_soil_torchflower_crop",state:{"farmersdelight:growth":0},land:["farmersdelight:rich_soil_farmland"]}]}},{tester:"corn_delight:corn_seeds",crops:{"corn_delight:corn_crop":{state:{"corn_delight:growth":7,"corn_delight:upper":!1},seed:"corn_delight:corn_seeds"}},seeds:{"corn_delight:corn_seeds":[{block:"corn_delight:corn_crop",state:{"corn_delight:growth":0,"corn_delight:upper":!1},land:["minecraft:farmland","farmersdelight:rich_soil_farmland"]}]}},{tester:"餐厨工艺:白菜",crops:{"餐厨工艺:白菜_植株":{state:{"zhizhu:xxx":6},seed:"餐厨工艺:白菜种子"},"餐厨工艺:白萝卜_植株":{state:{"zhizhu:xxx":6},seed:"餐厨工艺:白萝卜种子"},"餐厨工艺:大豆_植株":{state:{"zhizhu:xxx":6},seed:"餐厨工艺:大豆种子"},"餐厨工艺:番茄_植株":{state:{"zhizhu:xxx":6},seed:"餐厨工艺:番茄种子"},"餐厨工艺:红薯_植株":{state:{"zhizhu:xxx":6},seed:"餐厨工艺:红薯种子"},"餐厨工艺:黄瓜_植株":{state:{"zhizhu:xxx":6},seed:"餐厨工艺:黄瓜种子"},"餐厨工艺:茄子_植株":{state:{"zhizhu:xxx":6},seed:"餐厨工艺:茄子种子"},"餐厨工艺:辣椒_植株":{state:{"zhizhu:lajiao":6},seed:"餐厨工艺:辣椒种子"},"餐厨工艺:青椒_植株":{state:{"zhizhu:lajiao":6},seed:"餐厨工艺:青椒种子"},"餐厨工艺:水稻_植株_0":{state:{"zhizhu:xxx":6},seed:"餐厨工艺:水稻种子"},"餐厨工艺:玉米_植株_0":{state:{"zhizhu:xxx":6},seed:"餐厨工艺:玉米种子"}},seeds:{"餐厨工艺:白菜种子":[{block:"餐厨工艺:白菜_植株",state:{"zhizhu:xxx":1},land:["minecraft:farmland"]}],"餐厨工艺:白萝卜种子":[{block:"餐厨工艺:白萝卜_植株",state:{"zhizhu:xxx":1},land:["minecraft:farmland"]}],"餐厨工艺:大豆种子":[{block:"餐厨工艺:大豆_植株",state:{"zhizhu:xxx":1},land:["minecraft:farmland"]}],"餐厨工艺:番茄种子":[{block:"餐厨工艺:番茄_植株",state:{"zhizhu:xxx":1},land:["minecraft:farmland"]}],"餐厨工艺:红薯种子":[{block:"餐厨工艺:红薯_植株",state:{"zhizhu:xxx":1},land:["minecraft:farmland"]}],"餐厨工艺:黄瓜种子":[{block:"餐厨工艺:黄瓜_植株",state:{"zhizhu:xxx":1},land:["minecraft:farmland"]}],"餐厨工艺:茄子种子":[{block:"餐厨工艺:茄子_植株",state:{"zhizhu:xxx":1},land:["minecraft:farmland"]}],"餐厨工艺:辣椒种子":[{block:"餐厨工艺:辣椒_植株",state:{"zhizhu:lajiao":1},land:["minecraft:farmland"]}],"餐厨工艺:青椒种子":[{block:"餐厨工艺:青椒_植株",state:{"zhizhu:lajiao":1},land:["minecraft:farmland"]}],"餐厨工艺:水稻种子":[{block:"餐厨工艺:水稻_植株_0",state:{"zhizhu:xxx":1},land:["minecraft:farmland"]}],"餐厨工艺:玉米种子":[{block:"餐厨工艺:玉米_植株_0",state:{"zhizhu:xxx":1},land:["minecraft:farmland"]}]}}];const F=new class{Data={crops:{},seeds:{},lands:{}};corpList=[];landList=[];constructor(){for(let t of U)try{new i.ItemStack(t.tester,1);for(let e in t.crops)this.addCrop(e,t.crops[e]);for(let e in t.seeds)this.addSeed(e,t.seeds[e])}catch{}}addCrop(t,e){this.Data.crops[t]=e;try{this.corpList.push(i.BlockPermutation.resolve(t,e.state))}catch{}}addSeed(t,e){if(void 0===this.Data.seeds[t])this.Data.seeds[t]=e;else for(let a of e)this.Data.seeds[t].push(a);for(let a of e)for(let e of a.land)void 0===this.Data.lands[e]&&(this.Data.lands[e]=[]),this.Data.lands[e].push(t),this.landList.push(e)}getCorp(t){return this.Data.crops[t]}getSeed(t){return this.Data.seeds[t]}getLand(t){return this.Data.lands[t]}getLands(){return this.landList}getCorpPermutations(){return this.corpList}};class q{static targetAcquire(t){let e=t.damagingEntity,a=t.hitEntity;switch(a.typeId.substring(6)){case"sugar_cane":K.acquire(a,e);break;case"melon":J.acquire(a,e)}}static search(t,e=6){switch(X.Work.get(t)){case X.Work.farm:Y.search(t,e);break;case X.Work.sugar_cane:K.search(t,e);break;case X.Work.melon:J.search(t,e);break;case X.Work.cocoa:Z.search(t,e)}}static stepEvent(t,e){for(let a=0;a<3;a++)i.system.runTimeout((()=>{try{if(void 0===t)return;let a=t.target;if(void 0!==a){if(h(a.location.x,a.location.y,a.location.z,t.location.x-2,t.location.y-5,t.location.z-2,t.location.x+2,t.location.y+5,t.location.z+2))switch(e){case X.Work.farm:Y.acquire(a,t);break;case X.Work.melon:J.acquire(a,t);break;case X.Work.cocoa:Z.acquire(a,t)}a.triggerEvent("cooldown")}}catch{}}),20*a)}}class j{static beforeSearch(t,e=2,a=5){let i=t.getDynamicProperty("target_lack");return void 0!==i&&i>=e?(i++,i>=e+a?(t.setDynamicProperty("target_lack",e),{run:!0,lackmode:!0}):(t.setDynamicProperty("target_lack",i),{run:!1,lackmode:!0})):{run:!0,lackmode:!1}}static afterSearch(t,e,a=3,i=10){if(e<i){let e=t.getDynamicProperty("target_lack");void 0===e?t.setDynamicProperty("target_lack",1):e<a&&t.setDynamicProperty("target_lack",e+1)}else t.setDynamicProperty("target_lack",0)}}class Y{static maxLack=2;static lackStep=5;static minCount=8;static maxCount=25;static placeCorp(t,e){let a=t.getEntitiesAtBlockLocation(e);for(let t of a)if("thlmt:farm"===t.typeId)return;let i=t.spawnEntity("thlmt:farm",new b(e.x+.5,e.y+.2,e.z+.5));return i.setDynamicProperty("is_seed",!1),i}static placeSeed(t,e){let a=t.getEntitiesAtBlockLocation(e);for(let t of a)if("thlmt:farm"===t.typeId)return;let i=t.spawnEntity("thlmt:farm",new b(e.x+.5,e.y+.2,e.z+.5));return i.setDynamicProperty("is_seed",!0),i}static plantSeed(t,e,a,o){if(!0===X.Backpack.removeItem_type(t,a,1)){let r=F.getSeed(a);if(void 0!==r)for(let a of r)if(a.land.includes(o))return t.dimension.setBlockPermutation(e,i.BlockPermutation.resolve(a.block,a.state)),!0}return!1}static acquire(t,e){let a=t.location;const o=t.dimension;let r=o.getBlock(a),n=o.getBlock(new b(a.x,a.y-1,a.z));if(!0===t.getDynamicProperty("is_seed")){if(void 0!==r&&"minecraft:air"!==r.typeId)return void t.triggerEvent("despawn");let i=t.getDynamicProperty("crop"),s=!1;if(void 0===i){let t={};for(let e of[[-1,0],[1,0],[0,-1],[0,1]]){let i=o.getBlock(new b(a.x+e[0],a.y,a.z+e[1]));void 0!==i&&(void 0===t[i.typeId]?t[i.typeId]=1:t[i.typeId]++)}let e=0;for(let a in t)t[a]>e&&(F.getLand(),i=a,e=t[a])}else s=!0;if(void 0!==i){let o=F.getCorp(i);if(void 0!==o&&this.plantSeed(e,a,o.seed,n.typeId))return void t.triggerEvent("despawn")}if(s&&!t.getProperty("thlmt:cooldown")){t.triggerEvent("despawn");let e=o.spawnEntity("thlmt:farm",a);return e.setDynamicProperty("is_seed",!0),e.setDynamicProperty("crop",i),void e.triggerEvent("cooldown")}if(void 0!==n&&"minecraft:air"!==n.typeId){let i=F.getLand(n.typeId);if(void 0!==i)for(let o of i)if(this.plantSeed(e,a,o,n.typeId))return void t.triggerEvent("despawn")}t.triggerEvent("despawn")}else{let e=r.typeId,n=F.getCorp(e);void 0!==n&&r.permutation.matches(e,n.state)?void 0===n.keep?(o.runCommand(`setblock ${a.x} ${a.y} ${a.z} air destroy`),t.triggerEvent("life"),t.setDynamicProperty("is_seed",!0),t.setDynamicProperty("crop",e)):(t.runCommand(`loot spawn ~~~ loot "${n.keep.loot}"`),o.setBlockPermutation(t.location,i.BlockPermutation.resolve(n.keep.block,n.keep.state)),t.triggerEvent("despawn")):t.triggerEvent("despawn")}}static getTargets(t,e,a){let i=t.getEntities({location:e,maxDistance:a,type:"thlmt:farm"}),o=[];for(let t of i){let a=t.location.y-e.y;(a<2||a>-2)&&o.push(t)}return o}static search(t,e=6){if(void 0!==t.target)return;const a=t.dimension,o=t.location;let r=this.getTargets(a,o,e+10);if(r.length>6)return;let n=e,s=j.beforeSearch(t,this.maxLack,this.lackStep);if(!s.run)return;s.lackmode&&(n+=10),Math.floor(o.y),Math.floor(o.x),Math.floor(o.z);let l=r.length;i.system.runJob(function*(){let e=2*n+2,s=new Array(e);for(let t=0;t<e;t++)s[t]=new Array(e).fill(!1);for(let t of r)s[Math.floor(t.location.x-o.x+n)+1][Math.floor(t.location.z-o.z+n)+1]=!0;for(let t=0;t<n;t=t>0?-t:2-t){let e=a.getBlocks(new i.BlockVolume(new b(o.x+t,o.y-2,o.z-n),new b(o.x+t+1,o.y+2,o.z+n)),{includePermutations:F.getCorpPermutations(),includeTypes:F.getLands()},!0);for(let t of e.getBlockLocationIterator()){let e=Math.floor(t.x-o.x+n)+1,i=Math.floor(t.z-o.z+n)+1;if(!0===s[e][i])continue;let r=a.getBlock(t);if(void 0!==F.getLand(r.typeId)){let o=new b(t.x,t.y+1,t.z);if(r=a.getBlock(o),void 0===r||"minecraft:air"===r.typeId){Y.placeSeed(a,o),s[e][i]=!0,l++;continue}}let c=F.getCorp(r.typeId);if(void 0===c);else{let t=!0;for(let e in c.state)if(r.permutation.getState(e)!==c.state[e]){t=!1;break}t&&(Y.placeCorp(a,r.location),l++),s[e][i]=!0}}if(l>Y.maxCount)break}j.afterSearch(t,l,Y.maxLack,Y.minCount)}())}}class K{static maxLack=2;static lackStep=5;static minCount=10;static maxCount=40;static place(t,e){let a=t.getEntitiesAtBlockLocation(e);for(let t of a)if("thlmt:sugar_cane"===t.typeId)return;t.spawnEntity("thlmt:sugar_cane",new b(e.x+.5,e.y+.2,e.z+.5))}static acquire(t,e){let a=t.dimension.getBlock(t.location);if(void 0!==a&&"minecraft:reeds"===a.typeId){const t=a.location;a.dimension.runCommand(`setblock ${t.x} ${t.y} ${t.z} air destroy`)}t.triggerEvent("despawn")}static search(t,e=6){const a=t.dimension,o=t.location;if(a.getEntities({location:o,maxDistance:e,type:"thlmt:sugar_cane"}).length>3)return;let r=e,n=j.beforeSearch(t,this.maxLack,this.lackStep);if(!n.run)return;n.lackmode&&(r+=10);let s=Math.floor(o.y),l=Math.floor(o.x),c=Math.floor(o.z),m=0;for(let t=0;t<r;t=t>0?-t:1-t)i.system.runTimeout((()=>{for(let i=0;i<r;i=i>0?-i:1-i){if(m>this.maxCount)return;let o=l+t,r=c+i,n=s;var e=function(t){try{let e=a.getBlock(new b(o,t,r));return void 0!==e&&"minecraft:reeds"===e.typeId}catch{return!1}};if(e(n))if(e(n-1)){let t=n-2;for(let i=0;i<3;i++)if(!e(t-i)){s=t-i+2,this.place(a,new b(o,s,r)),m++;break}}else e(n+1)&&(s=n+1,this.place(a,new b(o,s,r)),m++);else{let t=!0;for(let i=1;i<=3;i++)if(e(n-i))if(e(n-i-1)){let l=n-i;for(let i=0;i<3;i++)if(!e(l-i)){s=l-i+2,this.place(a,new b(o,s,r)),m++,t=!1;break}t=!1}else t=!1;if(t)for(let t=1;t<=3;t++)if(e(n+t)){if(e(n+t+1)){s=n+t,this.place(a,new b(o,s,r)),m++;break}break}}}}),t<0?4-8*t:8*t);i.system.runTimeout((()=>{j.afterSearch(t,m,this.maxLack,this.minCount)}),8*r+8)}}class J{static maxLack=3;static lackStep=5;static minCount=8;static maxCount=20;static place(t,e){let a=t.getEntitiesAtBlockLocation(e);for(let t of a)if("thlmt:melon"===t.typeId)return;t.spawnEntity("thlmt:melon",new b(e.x+.5,e.y+.4,e.z+.5))}static acquire(t,e){let a=t.dimension.getBlock(t.location);if(void 0===a||"minecraft:melon_block"!==a.typeId&&"minecraft:pumpkin"!==a.typeId)t.triggerEvent("despawn");else{let e=t.getProperty("thlmt:step")+1;if(e<2)t.setProperty("thlmt:step",e),t.triggerEvent("life");else{const e=a.location;a.dimension.runCommand(`setblock ${e.x} ${e.y} ${e.z} air destroy`),t.triggerEvent("despawn")}}}static search(t,e=6){const a=t.dimension,o=t.location;let r=a.getEntities({location:o,maxDistance:e,type:"thlmt:melon"});if(r.length>3)return;let n=e,s=j.beforeSearch(t,this.maxLack,this.lackStep);if(!s.run)return;s.lackmode&&(n+=10);let l=Math.floor(o.x),c=Math.floor(o.z),m=Math.floor(o.y),d=2*n+1,u=new Array(d);for(let t=0;t<d;t++)u[t]=new Array(d);for(let t of r)u[Math.floor(t.location.x)-l+n][Math.floor(t.location.z)-c+n]=!0;let h=0;for(let t=0;t<n;t=t>0?-t:1-t)i.system.runTimeout((()=>{for(let e=0;e<n;e=e>0?-e:1-e){if(h>this.maxCount)return;if(void 0!==u[t+n][e+n])continue;let i=l+t,o=c+e,r=m;for(let s=0;s<3;s=s>0?-s:1-s){let l=a.getBlock(new b(i,r+s,o));if(void 0!==l&&("minecraft:melon_stem"===l.typeId||"minecraft:pumpkin_stem"===l.typeId)){if(7===l.permutation.getState("growth")){let i=l.location;try{switch(l.permutation.getState("facing_direction")){case 2:i.z--,this.place(a,i),h++,e>0&&(u[t+n][e+n-1]=!0),m=r;break;case 3:i.z++,this.place(a,i),h++,e<d-1&&(u[t+n][e+n+1]=!0),m=r;break;case 4:i.x--,this.place(a,i),h++,t>0&&(u[t+n-1][e+n]=!0),m=r;break;case 5:i.x++,this.place(a,i),h++,t<d-1&&(u[t+n+1][e+n]=!0),m=r}}catch{}}u[t+n][e+n]=!0;break}}}}),t<0?4-8*t:8*t);i.system.runTimeout((()=>{j.afterSearch(t,h,this.maxLack,this.minCount)}),8*n+8)}}class Z{static maxLack=3;static lackStep=5;static minCount=8;static maxCount=20;static place(t,e,a){let i=t.getEntitiesAtBlockLocation(e);for(let t of i)if("thlmt:cocoa"===t.typeId)return;t.spawnEntity("thlmt:cocoa",new b(e.x+.5,e.y+.5,e.z+.5)).setProperty("thlmt:direction",a)}static acquire(t,e){let a=t.dimension.getBlock(t.location);if(void 0!==a&&"minecraft:cocoa"===a.typeId){let e=t.getProperty("thlmt:step")+1;if(e>=2){const t=a.location;a.dimension.runCommand(`setblock ${t.x} ${t.y} ${t.z} air destroy`)}t.setProperty("thlmt:step",e),t.triggerEvent("life")}else{if("minecraft:air"===a.typeId&&!0===X.Backpack.removeItem_type(e,"minecraft:cocoa_beans",1)){let e=t.getProperty("thlmt:direction");const i=a.location;a.dimension.runCommand(`setblock ${i.x} ${i.y} ${i.z} cocoa ["direction"=${e},"age"=0] keep`)}t.triggerEvent("despawn")}}static search(t,e=6){const a=t.dimension,o=t.location;if(a.getEntities({location:o,maxDistance:e,type:"thlmt:cocoa"}).length>3)return;let r=e,n=j.beforeSearch(t,this.maxLack,this.lackStep);if(!n.run)return;n.lackmode&&(r+=10);let s=Math.floor(o.x),l=Math.floor(o.z),c=Math.floor(o.y),m=0;for(let t=0;t<r;t=t>0?-t:1-t)i.system.runTimeout((()=>{for(let e=0;e<r;e=e>0?-e:1-e){if(m>this.maxCount)return;let i=s+t,o=l+e,r=c;for(let t=4;t>-2;t--){let e=a.getBlock(new b(i,r+t,o));void 0!==e&&"minecraft:cocoa"===e.typeId&&2===e.permutation.getState("age")&&(this.place(a,e.location,e.permutation.getState("direction")),m++)}}}),t<0?4-8*t:8*t);i.system.runTimeout((()=>{j.afterSearch(t,m,this.maxLack,this.minCount)}),8*r+8)}}class X{static formatOutput(t){let e=[];return e.push({translate:"message.tlm.admin.maid_info"}),e.push({text:"\n"}),e.push({translate:"message.tlm.admin.maid.name"}),e.push({text:`${this.getNameTag(t)}\n`}),e.push({translate:"message.tlm.admin.maid.owner.name"}),e.push({text:`${this.Owner.getName(t)}\n`}),e.push({translate:"message.tlm.admin.maid.owner.id"}),e.push({text:`${this.Owner.getID(t)}\n`}),e.push({translate:"message.tlm.admin.maid.level"}),e.push({text:`${this.Level.get(t)}\n`}),e.push({translate:"message.tlm.admin.maid.kill"}),e.push({text:`${this.Kill.get(t)}\n`}),e.push({translate:"message.tlm.admin.maid.health"}),e.push({text:`${this.Health.get(t)}/${this.Health.getMax(t)}\n`}),e.push({translate:"message.tlm.admin.maid.work"}),e.push({text:`${X.Work.getName(this.Work.get(t))}\n`}),e.push({translate:"message.tlm.admin.maid.backpack"}),e.push({text:`${this.Backpack.getInvisible(t)}\n`}),e.push({translate:"message.tlm.admin.maid.pick"}),e.push({text:`${this.Pick.get(t)}\n`}),e.push({translate:"message.tlm.admin.maid.mute"}),e.push({text:`${this.Mute.get(t)}\n`}),e}static initDynamicProperties(t){void 0===R(t,"home")&&G(t,"home",{x:0,y:0,z:0}),void 0===O(t,"home_dim")&&W(t,"home_dim",0),void 0===O(t,"level")&&W(t,"level",1),void 0===O(t,"kill")&&W(t,"kill",0),void 0===N(t,"pick")&&H(t,"pick",!1)}static Level={max:2,properties:[{danmaku:15,heal:[3,6]},{danmaku:24,heal:[5,8]},{danmaku:24,heal:[5,8]}],str:["§l§aLv.1§r","§l§bLv.2§r","§l§cLv.3§r","§l§dLv.4§r","§l§eLv.5§r","§l§bL§cv§d.§e6§r"],get:t=>O(t,"level"),getStr(t){return this.str[this.get(t)-1]},set(t,e){let a=this.get(t);void 0!==a&&t.triggerEvent(`api:lv_${a}_basic_quit`),void 0!==t.getComponent("minecraft:is_tamed")&&t.triggerEvent(`api:lv_${a}_tame_quit`),i.system.runTimeout((()=>{this.eventBasic(t,e),void 0!==t.getComponent("minecraft:is_tamed")&&this.eventTamed(t,e)}),1),W(t,"level",e)},eventBasic(t,e){t.triggerEvent(`api:lv_${e}_basic`)},eventTamed(t,e){t.triggerEvent(`api:lv_${e}_tame`)},getProperty(t,e){return this.properties[this.get(t)-1][e]}};static Owner={refresh(t){let e=t.getComponent("tameable");void 0!==e.tamedToPlayerId&&this.setID(t,e.tamedToPlayerId),void 0!==e.tamedToPlayer&&this.setName(t,e.tamedToPlayer.name)},has(t){return void 0!==this.getID(t)||null!=this.getName(t)},getID:t=>M(t,"thlmo:"),setID(t,e){z(t,"thlmo:"),L(t,"thlmo:",e)},getName:t=>M(t,"thlmn:"),setName(t,e){z(t,"thlmn:"),L(t,"thlmn:",e)},get(t){let e=this.getID(t);if(void 0!==e)return i.world.getEntity(e);let a=this.getName(t);if(void 0!==a){let t=i.world.getPlayers({name:a});if(0!==t.length())return t[0]}},set(t,e){t.getComponent("tameable").tame(e),this.setID(t,e.id),this.setName(t,e.name)}};static Health={getComponent:t=>t.getComponent("health"),get(t){return this.getComponent(t).currentValue},getMax(t){return this.getComponent(t).defaultValue},set(t,e){return this.getComponent(t).setCurrentValue(e)},setMax(t,e){},strOffset:58880,toStr(t){let e="",a=(Math.floor(t/20),t%20);0===a&&(a=20);for(let t=10;t>0;)a>=2?(a-=2,e+=this.fullStr()):1===a?(a-=1,e+=this.halfStr()):e+=this.emptyStr(),t--;return e},emptyStr(){return String.fromCodePoint(this.strOffset+3)},halfStr(){return String.fromCodePoint(this.strOffset+4)},fullStr(){return String.fromCodePoint(this.strOffset+5)}};static Kill={get(t){let e=O(t,"kill");return void 0===e?0:e},set(t,e){W(t,"kill",e)}};static Skin={setPack(t,e){t.setProperty("thlm:skin_pack",e)},setIndex(t,e){t.triggerEvent(`skin:${e}`)},getPack:t=>t.getProperty("thlm:skin_pack"),getIndex:t=>t.getComponent("minecraft:variant").value,setRandom(t){let e=C.getRandom();this.setPack(t,e.pack),this.setIndex(t,e.seq)}};static Pick={set(t,e){t.triggerEvent(e?"api:mode_pick":"api:mode_quit_pick"),H(t,"pick",e)},switchMode(t){this.set(t,!this.get(t))},get:t=>N(t,"pick"),magnet(t,e){let a=X.Backpack.getContainer(t),i=t.dimension.getEntities({location:t.location,type:"minecraft:item",maxDistance:e});for(let t of i){let e=t.getComponent("minecraft:item").itemStack,i=e.amount,o=a.addItem(e);void 0===o?(t.dimension.spawnParticle("touhou_little_maid:item_get",t.location),t.remove()):i!==o.amount&&(t.dimension.spawnItem(o,t.location).clearVelocity(),t.dimension.spawnParticle("touhou_little_maid:item_get",t.location),t.remove())}},getImg:t=>t?"textures/gui/pick_activate.png":"textures/gui/pick_deactivate.png",getLang:t=>t?"gui.touhou_little_maid:button.pick.true.name":"gui.touhou_little_maid:button.pick.false.name"};static Ride={switchMode(t){},getImg:t=>t?"textures/gui/ride_activate.png":"textures/gui/ride_deactivate.png",getLang:t=>t?"gui.touhou_little_maid:button.ride.true.name":"gui.touhou_little_maid:button.ride.false.name"};static Work={AMOUNT:7,idle:0,attack:1,danmaku_attack:2,farm:3,sugar_cane:4,melon:5,cocoa:6,grass:7,snow:8,feed:9,shears:10,milk:11,torch:12,feed_animal:13,extinguishing:14,ranged_attack:15,NAME_LIST:["idle","attack","danmaku_attack","farm","sugar_cane","melon","cocoa","grass","snow","feed","shears","milk","torch","feed_animal","extinguishing","ranged_attack"],SOUND_LIS:[void 0,"mob.thlmm.maid.attack","mob.thlmm.maid.attack",void 0,void 0,void 0,void 0,void 0,void 0,"mob.thlmm.maid.feed",void 0,void 0,void 0,"mob.thlmm.maid.feed",void 0],IMG_LIST:["textures/items/feather.png","textures/items/diamond_sword.png","textures/items/hakurei_gohei.png","textures/items/iron_hoe.png","textures/items/reeds.png","textures/items/melon.png","textures/items/dye_powder_brown.png","textures/blocks/tallgrass.png","textures/items/snowball.png","textures/items/beef_cooked.png","textures/items/shears.png","textures/items/bucket_milk.png","textures/items/torch_on.png","textures/items/wheat.png","textures/items/extinguisher.png","textures/items/bow_standby.png"],get:t=>t.getProperty("thlm:work"),set(t,e){t.triggerEvent(this.getEventName(t,this.get(t),!0)),i.system.runTimeout((()=>{t.triggerEvent(this.getEventName(t,e,!1)),q.search(t,15)}),1)},quit(t){t.triggerEvent(this.getEventName(t,this.get(t),!0))},enter(t,e){t.triggerEvent(this.getEventName(t,e))},getName(t){return this.NAME_LIST[t]},getEventName(t,e,a){let i="api:mode_";return a&&(i+="quit_"),i+=this.getName(e),e===this.attack&&(i+=`_lv${X.Level.get(t)}`),i},getLang(t){return`task.touhou_little_maid:${this.getName(t)}.name`},getIMG(t){return this.IMG_LIST[t]},getSound(t){return this.SOUND_LIST[t]}};static Home={getMode:t=>t.getProperty("thlm:home"),switchMode(t){!0===this.getMode(t)?t.triggerEvent("api:status_follow"):(this.setLocation(t),t.triggerEvent("api:status_home"))},getImg:t=>t?"textures/gui/home_activate.png":"textures/gui/home_deactivate.png",getLang:t=>t?"gui.touhou_little_maid:button.home.true.name":"gui.touhou_little_maid:button.home.false.name",setLocation(t){let e=t.location;G(t,"home",{x:e.x,y:e.y,z:e.z}),W(t,"home_dim",function(t){switch(t){case"minecraft:overworld":return 0;case"minecraft:nether":return 1;case"minecraft:the_end":return 2;default:return}}(t.dimension.id))},getLocation(t){let e=R(t,"home");if(void 0===e)return;let a=O(t,"home_dim");if(void 0===a)return;let i=e.x,o=e.y,r=e.z;return 0!==i||0!==o||0!==r||0!==a?[i,o,r,p(a)]:void 0}};static Backpack=class{static default=0;static small=1;static middle=2;static big=3;static capacityList=[6,12,24,36];static nameList=["default","small","middle","big"];static getInvisible(t){return t.getProperty("thlm:backpack_invisible")}static setInvisible(t,e){return t.setProperty("thlm:backpack_invisible",e)}static getContainer(t){return t.getComponent("inventory").container}static getType(t){return t.getProperty("thlm:backpack_type")}static setType(t,e){t.triggerEvent(`api:backpack_${this.getName(e)}`)}static nameTags=["§t§h§l§m§d§r","§t§h§l§m§s§r","§t§h§l§m§m§r","§t§h§l§m§b§r"];static isCheckMode(t){return!0===t.getDynamicProperty("inv_check")}static getNamePrefix(t){return this.nameTags[this.getType(t)]}static checkMode(t){return t.setDynamicProperty("name",t.nameTag),t.setDynamicProperty("inv_check",!0),t.nameTag=this.getNamePrefix(t),!0}static quitCheckMode(t){return t.nameTag=t.getDynamicProperty("name"),t.setDynamicProperty("name"),t.setDynamicProperty("inv_check",!1),!0}static addItem(t,e){let a=this.getContainer(t);return void 0===a?0:a.addItem(e)}static removeItem(t,e,a){let i=this.getContainer(t);if(void 0===i)return!1;let o=a;for(let t=0;t<i.size;t++){let r=i.getItem(t);if(void 0!==r&&r.isStackableWith(e)){if(!(r.amount<o)){if(r.amount===o)return i.setItem(t),!0;{let e=r.clone();return e.amount-=o,i.setItem(t,e),!0}}o-=a,i.setItem(t)}}return o}static removeItem_type(t,e,a){let i=this.getContainer(t);if(void 0===i)return!1;let o=a;for(let t=0;t<i.size;t++){let r=i.getItem(t);if(void 0!==r&&r.typeId===e){if(!(r.amount<o)){if(r.amount===o)return i.setItem(t),!0;{let e=r.clone();return e.amount-=o,i.setItem(t,e),!0}}o-=a,i.setItem(t)}}return o}static clearAll(t){let e=this.getContainer(t);if(void 0===e)return!1;e.clearAll()}static getItem(t,e){let a=this.getContainer(t);if(void 0!==a)return a.getItem(e)}static getSlot(t,e){let a=this.getContainer(t);if(void 0!==a)return a.getSlot(e)}static moveItem(t,e,a,i){let o=this.getContainer(t);void 0!==o&&o.moveItem(e,a,i)}static setItem(t,e,a=void 0){let i=this.getContainer(t);void 0!==i&&i.setItem(e,a)}static swapItems(t,e,a){let i=this.getContainer(t);void 0!==i&&i.swapItems(e,a)}static getCapacity(t){return this.capacityList[t]}static getName(t){return this.nameList[t]}static getItemName(t){return`touhou_little_maid:maid_backpack_${this.getName(t)}`}static dump(t,e=t.location){let a=t.dimension,i=this.getContainer(t);for(let t=0;t<i.size;t++){let o=i.getItem(t);void 0!==o&&(a.spawnItem(o.clone(),e),i.setItem(t))}}static getButtonLang(t){return t?"gui.touhou_little_maid:button.backpack.true.name":"gui.touhou_little_maid:button.backpack.false.name"}static getButtonImg(t){return t?"textures/gui/maid_backpack_deactivate.png":"textures/gui/maid_backpack_activate.png"}};static Emote={timeout:void 0,get:t=>t.getProperty("thlm:emote"),set(t,e){void 0!==this.timeout&&(i.system.clearRun(this.timeout),this.timeout=void 0);let a=e;void 0!==P[e]&&(a+=1e3*P[e][0],a+=1e6*P[e][1],this.timeout=i.system.runTimeout((()=>{this.set(t,0)}),P[e][2])),t.setProperty("thlm:emote",a)},clear(t){this.set(t,0)},backpack(t){this.set(t,1+X.Backpack.getType(t))},apple(t){this.set(t,5)},cake(t){this.set(t,6)}};static Mute={set(t,e){H(t,"mute",e)},switchMode(t){this.set(t,!this.get(t))},get(t){let e=N(t,"mute");return void 0===e?(this.set(t,!1),!1):e},getImg:t=>t?"textures/gui/mute_activate.png":"textures/gui/mute_deactivate.png",getLang:t=>t?"gui.touhou_little_maid:button.mute.true.name":"gui.touhou_little_maid:button.mute.false.name"};static Statues={scale:{set(t,e){t.setProperty("thlm:scale",e)},get:t=>t.getProperty("thlm:scale")},space:{set(t,e){G(t,"space",e)},get:t=>R(t,"space")}};static Sound=class{static disableTamed(t){t.setDynamicProperty("sound:disable_tamed",!0)}static tamed(t){!0!==t.getDynamicProperty("sound:disable_tamed")?this.playSound(t,"mob.thlmm.maid.tamed"):t.setDynamicProperty("sound:disable_tamed")}static playSound(t,e){t.dimension.runCommand(`playsound ${e} @a ${t.location.x} ${t.location.y} ${t.location.z}`)}};static init_maid(t,e=!1){void 0===t.getDynamicProperty("spawn_set")&&(t.triggerEvent(e?"become_maid_reborn":"become_maid"),e||(X.initDynamicProperties(t),i.system.runTimeout((()=>{X.Work.get(t)<0||X.Owner.has(t)||X.Skin.setRandom(t)}),1)),t.setDynamicProperty("spawn_set",!0))}static toStr(t,e=!0){let a="",i=this.Owner.getID(t);void 0!==i&&(a=T.Owner.setID(a,i)),a=T.Level.set(a,this.Level.get(t)),a=T.Kill.set(a,this.Kill.get(t));let o=t.getComponent("health");return a=T.Health.set(a,o.currentValue,o.defaultValue),a=T.Skin.set(a,this.Skin.getPack(t),this.Skin.getIndex(t)),a=T.Work.set(a,this.Work.get(t)),a=T.Pick.set(a,this.Pick.get(t)),a=T.Mute.set(a,this.Mute.get(t)),a=T.backpackInvisibility.set(a,this.Backpack.getInvisible(t)),a=T.backpackType.set(a,this.Backpack.getType(t)),void 0!==i&&(a=T.Str.setOwnerName(a,this.Owner.getName(t)),""!==this.getNameTag(t)&&(a=T.Str.setMaidName(a,this.getNameTag(t)))),e&&this.Backpack.dump(t),a}static fromStr(t,e,a,o=!1){let r,n=T.Owner.getId(t),s=T.Str.getOwnerName(t),l=!1;if(void 0!==n&&(l=!0,r=i.world.getEntity(n)),void 0===r&&void 0!==s&&(l=!0,r=i.world.getPlayers({name:s})[0]),l&&void 0===r)return;var c=e.spawnEntity("thlmm:maid",a);this.init_maid(c,!0),this.Level.set(c,T.Level.get(t)),this.Kill.set(c,T.Kill.get(t)),void 0!==n&&this.Owner.setID(c,n),o&&i.system.runTimeout((()=>{this.Health.set(c,T.Health.get(t).current)}),2);let m=T.Skin.get(t);this.Skin.setPack(c,m.pack),this.Skin.setIndex(c,m.index),c.setDynamicProperty("temp_work",T.Work.get(t)),this.Pick.set(c,T.Pick.get(t)),this.Mute.set(c,T.Mute.get(t)),this.Backpack.setInvisible(c,T.backpackInvisibility.get(t));let d=T.backpackType.get(t);void 0!==d&&d>0&&d<=3&&this.Backpack.setType(c,d);let u=T.Str.getMaidName(t);return void 0!==u&&(c.nameTag=u),void 0!==s&&this.Owner.setName(c,s),l&&(this.Sound.disableTamed(c),i.system.runTimeout((()=>{c.getComponent("tameable").tame(r)}),1)),c}static toLore(t,e=!0){return _(this.toStr(t,e))}static despawn(t){t.triggerEvent("despawn")}static playSound(t,e){t.dimension.runCommand(`playsound ${e} @a ${t.location.x} ${t.location.y} ${t.location.z}`)}static spawnRandomMaid(t,e){return t.spawnEntity("thlmm:maid",e)}static isSafeBlock(t){return!(void 0!==t&&!t.isAir)}static isSitting(t){return t.getProperty("thlm:is_sitting")}static sitDown(t){t.triggerEvent("thlmm:v")}static standUp(t){t.triggerEvent("thlmm:w")}static getNameTag(t){if(this.Backpack.isCheckMode(t)){let e=t.getDynamicProperty("name");return void 0===e?"":e}return t.nameTag}}class Q{constructor(t,e){this.count=t,this.edge=e,this.path=[],this.on_path=[];for(let e=0;e<t;e++)this.path[e]=-1,this.on_path[e]=!1}outputRes(){for(let t=0;t<this.count;t++);}clearOnPathSign(){for(let t=0;t<this.count;t++)this.on_path[t]=!1}findAugPath(t){for(let e=0;e<this.count;e++)if(1==this.edge[t][e]&&!this.on_path[e]&&(this.on_path[e]=!0,-1==this.path[e]||this.findAugPath(this.path[e])))return this.path[e]=t,!0;return!1}isPerfect(){for(let t=0;t<this.count;t++)if(-1==this.path[t])return!1;return!0}match(){for(let t=0;t<this.count;t++)this.findAugPath(t),this.clearOnPathSign();return this.isPerfect()}}const tt=new class{constructor(){this.recipes=[[],[],[],[],[],[]],this.tags=S;for(let t in I)this.addRecipe(I[t])}addRecipe(t){let e=t.ingredients.length;return!!(e&&1<=e&&e<=6)&&(this.recipes[e-1].push(t),!0)}addTagDefine(t){this.tags[t.name]||(this.tags[t.name]=t.data)}matchRecipes(t,e,a,i){let o=e.length,r=E.get_power_number(t);if(1<=o&&o<=6)for(let n of this.recipes[o-1])if(this.matchRecipe(e,n.ingredients)){let o=r-Math.floor(100*n.power);if(o>=0)return!!this.summonOutput(a,i,n.output,e,t)&&(E.set_power_number(t.name,o),!0);w(t.name,"message.touhou_little_maid:altar.not_enough_power.name")}return!1}matchRecipe(t,e){let a=t.length,i=[];for(let o=0;o<a;o++){i[o]=[];for(let r=0;r<a;r++)i[o][r]=this.isItemMatchDefine(t[o],e[r])}return new Q(a,i).match()}isItemMatchDefine(t,e){let a=!1;if(e.item){if(t.typeId!=e.item)return!1;a=!0}if(e.tag&&this.tags[e.tag]){let i=!1;for(let o of this.tags[e.tag])if(this.isItemMatchDefine(t,o)){i=!0,a=!0;break}if(!i)return!1}return a}summonOutput(t,e,a,o,r){try{switch(a.type){case"minecraft:item":let n=a.nbt.Item,s=1;if(!n.id)return!1;n.Count&&(s=n.Count);let l=new i.ItemStack(n.id,s);if(null!=n.Enchantments){let t=l.getComponent("minecraft:enchantable");for(let e in n.Enchantments)t.addEnchantment({type:i.EnchantmentTypes.get(e),level:n.Enchantments[e]})}t.spawnItem(l,e);break;case"thlm:repair":for(let i of o)if(this.isItemMatchDefine(i,a.item.target)){let o=i.clone(),r=o.getComponent("minecraft:durability");return r.damage=Math.max(0,r.damage-a.item.amount),t.spawnItem(o,e),!0}break;case"touhou_little_maid:maid":for(let i of o)if(this.isItemMatchDefine(i,a.copy.ingredient)){let a=i.getLore();if(0===a.length)return!1;let o=y(a);return void 0!==X.fromStr(o,t,e,!1)}break;case"touhou_little_maid:maid_upgrade":let c,m=a.level-1,d=t.getEntities({location:e,maxDistance:2,type:"thlmm:maid"});for(let t of d)if(X.Level.get(t)===m){c=t;break}if(void 0===c)return w(r.name,"message.touhou_little_maid.altar.upgrade.notfound"),!1;if(X.Kill.get(c)<a.kills)return function(t,e){i.world.getDimension("overworld").runCommand(`titleraw ${k(t)} actionbar ${JSON.stringify(e)}`)}(r.name,{rawtext:[{translate:"message.touhou_little_maid.altar.upgrade.kill"},{text:`(${X.Kill.get(c)}/${a.kills})`}]}),!1;X.Work.set(c,0),X.Level.set(c,m+1),X.Kill.set(c,0),w(r.name,"message.touhou_little_maid.altar.upgrade.success");break;default:t.spawnEntity(a.type,e)}return!0}catch{return!1}}},et=new class extends n{constructor(){super([8,6,8],void 0,[{location:[2,0,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[2,1,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[2,2,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[2,3,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[2,4,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[2,5,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[5,0,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[5,1,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[5,2,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[5,3,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[5,4,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[5,5,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[1,3,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[3,3,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[4,3,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[6,3,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[1,5,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[3,5,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[4,5,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[6,5,0],deactivated:{name:"minecraft:red_wool",data:null},activated:{name:"touhou_little_maid:altar_torii_block"},data:null},{location:[0,0,2],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[0,1,2],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[0,2,2],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_platform_block",data:{"touhou_little_maid:number":1,"touhou_little_maid:rotation":"r"}}},{location:[0,0,5],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[0,1,5],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[0,2,5],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_platform_block",data:{"touhou_little_maid:number":2,"touhou_little_maid:rotation":"r"}}},{location:[2,0,7],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[2,1,7],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[2,2,7],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_platform_block",data:{"touhou_little_maid:number":3,"touhou_little_maid:rotation":"r"}}},{location:[5,0,7],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[5,1,7],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[5,2,7],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_platform_block",data:{"touhou_little_maid:number":4,"touhou_little_maid:rotation":"r"}}},{location:[7,0,2],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[7,1,2],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[7,2,2],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_platform_block",data:{"touhou_little_maid:number":5,"touhou_little_maid:rotation":"r"}}},{location:[7,0,5],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[7,1,5],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_log_block",data:null}},{location:[7,2,5],deactivated:{name:"minecraft:oak_log",data:{pillar_axis:"y"}},activated:{name:"touhou_little_maid:altar_platform_block",data:{"touhou_little_maid:number":6,"touhou_little_maid:rotation":"r"}}}]),this.entities=[{location:[2,4,0],name:"touhou_little_maid:altar_main"}],this.platforms=[[0,2,2],[0,2,5],[2,2,7],[5,2,7],[7,2,2],[7,2,5]]}activate(t,e,a){let o=null,r=null;switch(a){case i.Direction.North:o=0,r="north";break;case i.Direction.East:o=1,r="east";break;case i.Direction.South:o=2,r="south";break;case i.Direction.West:o=3,r="west";break;default:return!1}let n=[e.x,e.y,e.z],s=super.getBaseLocationByPoint([3,3,0],n,o);if(-1==super.activate(t,s,[o])&&(s=super.getBaseLocationByPoint([4,3,0],n,o),-1==super.activate(t,s,[o])&&(s=null)),null!=s)for(let e of this.entities){let a=super.rotateCoordinate(e.location,o),i=Math.ceil(s[0]+a[0])+.5,n=Math.ceil(s[1]+a[1]),l=Math.ceil(s[2]+a[2])+.5;t.spawnEntity(e.name,{x:i,y:n,z:l}).triggerEvent(r)}}deactivateEvent(t){let e=t.getComponent("minecraft:variant").value,a=super.getBaseLocationByPoint([2,4,0],[Math.floor(t.location.x),Math.floor(t.location.y),Math.floor(t.location.z)],e);if(super.deactivate(t.dimension,a,e)){t.dimension.runCommand(`event entity @e[x=${a[0]},y=${a[1]},z=${a[2]},dx=8,dy=6,dz=8,type=touhou_little_maid:altar_main] despawn`);for(let i of this.platforms){let o=super.getPointByBaseLocation(i,a,e),r=this.searchAltarItemEntity(t.dimension,{x:o[0],y:o[1]+1,z:o[2]});null!=r&&this.popItem(r)}}}placeItemEvent(t,e){let a=e.dimension,o=this.searchAltarItemEntity(a,{x:t.x,y:t.y+1,z:t.z}),r=e.getComponent("inventory").container,n=e.selectedSlotIndex,s=r.getItem(n);if(null==o){if(s&&""!=s.typeId)if(1==s.amount){let a=e.dimension.spawnItem(s.clone(),{x:t.x+.5,y:t.y+1,z:t.z+.5});a.clearVelocity(),a.addTag("touhou_little_maid:altar_item"),r.setItem(n),i.system.runTimeout((()=>{this.craftEvent(t,e)}),1)}else{let a=s.clone();a.amount=1;let o=e.dimension.spawnItem(a,{x:t.x+.5,y:t.y+1,z:t.z+.5});o.clearVelocity(),o.addTag("touhou_little_maid:altar_item"),s.amount--,r.setItem(n,s),i.system.runTimeout((()=>{this.craftEvent(t,e)}),1)}}else s&&""!=s.typeId||this.popItem(o)}craftEvent(t,e){let a=e.dimension.getBlock(t),i=a.permutation.getState("touhou_little_maid:number")-1,o=a.permutation.getState("touhou_little_maid:rotation")-1,r=super.getBaseLocationByPoint(this.platforms[i],[t.x,t.y,t.z],o),n=[],s=[];for(let t of this.platforms){let a=super.getPointByBaseLocation(t,r,o),i=this.searchAltarItemEntity(e.dimension,{x:a[0],y:a[1]+1,z:a[2]});if(null!=i){let t=i.getComponent("minecraft:item").itemStack;1==t.amount?(n.push(i),s.push(t)):this.popItem(i)}}let l=super.getPointByBaseLocation([3.5,0,3.5],r,o);if(tt.matchRecipes(e,s,e.dimension,{x:l[0],y:l[1],z:l[2]}))for(let t of n)t.kill(),e.dimension.runCommand(`playsound altar_craft ${k(e.name)}`)}searchAltarItemEntity(t,e){for(let a of t.getEntitiesAtBlockLocation(e))if("minecraft:item"==a.typeId&&a.hasTag("touhou_little_maid:altar_item"))return a;return null}popItem(t){t.removeTag("touhou_little_maid:altar_item");let e=m()<.5?1:-1,a=m()<.5?1:-1;t.applyImpulse(new b(e*m(.1,.2),m(.3,.4),a*m(.1,.2)))}refreshItemsEvent(t){let e=t.getComponent("minecraft:variant").value,a=super.getBaseLocationByPoint([2,4,0],[Math.floor(t.location.x),Math.floor(t.location.y),Math.floor(t.location.z)],e);for(let i of this.platforms){let o=super.getPointByBaseLocation(i,a,e),r={x:o[0]+.5,y:o[1]+1,z:o[2]+.5},n=this.searchAltarItemEntity(t.dimension,r);if(null!=n){let e=n.getComponent("minecraft:item").itemStack,a=t.dimension.spawnItem(e,r);a.addTag("touhou_little_maid:altar_item"),a.clearVelocity(),n.kill()}}}},at=(t=>{var e={};return a.d(e,t),e})({ActionFormData:()=>e.ActionFormData});class it{static AMOUNT=13;static RANDOM=-1;static RED=1;static ORANGE=2;static YELLOW=3;static LIME=4;static LIGHT_GREEN=5;static GREEN=6;static CYAN=7;static LIGHT_BLUE=8;static BLUE=8;static PURPLE=9;static MAGENTA=11;static PINK=12;static GRAY=13;constructor(t){this.rgb=t,this.red=t>>16&255,this.green=t>>8&255,this.blue=255&t,this.floatRed=this.red/255,this.floatGreen=this.green/255,this.floatBlue=this.blue/255}static getColor(t){return t<=0||t>this.AMOUNT?this.RED:t}static getTriggerEvent(t){return t==this.RANDOM?"init_ramdon":"init_c"+this.getColor(t)}static random(){return 1+Math.floor(Math.random()*this.AMOUNT)}static getLength(){return this.AMOUNT}getRed(){return this.red}getGreen(){return this.green}getBlue(){return this.blue}getFloatRed(){return this.floatRed}getFloatGreen(){return this.floatGreen}getFloatBlue(){return this.floatBlue}getRgb(){return this.rgb}}class ot{static DanmakuPrefix="thlmd:danmaku_basic_";static AMOUNT=10;static RANDOM=-1;static PELLET=1;static BALL=2;static ORBS=3;static BIG_BALL=4;static BUBBLE=5;static HEART=6;static AMULET=7;static STAR=8;static BIG_STAR=9;static GLOWEY_BALL=10;static PETAL=11;static KNIFE=12;static MASTER_SPARK=13;static BULLET=14;static KUNAI=15;static RAINDROP=16;static ARROWHEAD=17;static BUTTERFLY=18;static JELLYBEAN=19;static NAME_LIST=["pellet","ball","orbs","big_ball","bubble","heart","amulet","star","big_star","glowey_ball"];constructor(t){this.size=t}static getType(t){return t<=0||t>this.AMOUNT?this.PELLET:t}static random(){return 1+Math.floor(Math.random()*this.AMOUNT)}static getLength(){return this.AMOUNT}static getName(t){return this.NAME_LIST[this.getType(t)-1]}static getEntityName(t){return t==this.RANDOM?this.DanmakuPrefix+this.NAME_LIST[this.random()-1]:this.DanmakuPrefix+this.NAME_LIST[this.getType(t)-1]}getSize(){return this.size}}class rt{constructor(t,e){this.world=t,this.thrower=e,this.enableThrowerLocation=!1,this.Throwerlocation=void 0,this.thrower_offset=new b(0,0,0),this.damage=6,this.color=it.RANDOM,this.type=ot.RANDOM,this.ticks_existed=0,this.ownerID=void 0}shoot_bedrock(t,e){let a;if(this.enableThrowerLocation)a=this.Throwerlocation;else{let t;try{t=this.thrower.location}catch{return!1}a=new b(t.x+this.thrower_offset.x,t.y+this.thrower_offset.y,t.z+this.thrower_offset.z)}let i=this.type==ot.RANDOM?ot.random():this.type,o=this.world.spawnEntity(ot.getEntityName(i),a);o.triggerEvent(it.getTriggerEvent(this.color)),!1!==this.thrower&&o.setDynamicProperty("source",this.thrower.id),o.setDynamicProperty("damage",this.damage),void 0!==this.ownerID&&o.setDynamicProperty("owner",this.ownerID);let r=t;if(0!==e){let t;if(0==r.x&&0==r.y){if(0==r.z)return!1;t=new b(1,0,0)}else t=0==r.y?new b(0,1,0):new b(1,-r.x/r.y,0);t=x.rotate_axis(t,r,m(0,2*Math.PI)),r=x.rotate_axis(r,t,m(0,e))}o.applyImpulse(r)}shoot(t,e,a=0){let o;if(this.enableThrowerLocation)o=this.Throwerlocation;else{let t;try{t=this.thrower.location}catch{return!1}o=new b(t.x+this.thrower_offset.x,t.y+this.thrower_offset.y,t.z+this.thrower_offset.z)}let r,n=this.type==ot.RANDOM?ot.random():this.type,s=this.world.spawnEntity(ot.getEntityName(n),o);if(s.triggerEvent(it.getTriggerEvent(this.color)),!1!==this.thrower&&s.setDynamicProperty("source",this.thrower.id),s.setDynamicProperty("damage",this.damage),void 0!==this.ownerID&&s.setDynamicProperty("owner",this.ownerID),0==e)r=new b(0,0,0);else if(r=x.getVector_speed_direction(e,new b(t.x,t.y,t.z)),0!=a){let e;if(0==t.x&&0==t.y){if(0==t.z)return!1;e=new b(1,0,0)}else e=0==t.y?new b(0,1,0):new b(1,-t.x/t.y,0);e=x.rotate_axis(e,r,m(0,2*Math.PI)),r=x.rotate_axis(r,e,m(0,a))}s.applyImpulse(r),this.ticks_existed>0&&i.system.runTimeout((()=>{try{s.triggerEvent("despawn")}catch{}}),this.ticks_existed)}setDamage(t){return this.damage=t,this}setColor(t){return this.color=t,this}setDanmakuType(t){return this.type=t,this}static getDamage(t){return t.getDynamicProperty("damage")}static hasSameOwner(t,e){return!1}setGravityVelocity(t){return this}setThrower(t){return this.thrower=t,this.enableThrowerLocation=!1,this}setThrowerLocation(t){return this.Throwerlocation=t,this.enableThrowerLocation=!0,this}setThrowerOffset(t){return this.thrower_offset=t,this}setLifeTime(t){return this.ticks_existed=t,this}setOwnerID(t){return this.ownerID=t,this}}class nt{static RANDOM=Math.random();static MAX_YAW=2*Math.PI;static MIN_FAN_NUM=2;constructor(){this.world=void 0,this.thrower=void 0,this.target=void 0,this.enable_shoot_location=!1,this.shoot_location=void 0,this.enable_target_location=!1,this.target_location=void 0,this.pre_judge=!1,this.pre_judge_verticle=!1,this.target_offset=new b(0,0,0),this.thrower_offset=new b(0,0,0),this.color=it.RANDOM,this.type=ot.RANDOM,this.damage=6,this.gravity=.2,this.velocity=.6,this.inaccuracy=0,this.lifeTime=0,this.yawTotal=3,this.fanNum=3,this.axisRotation=0,this.directionRotation=0,this.ownerID=void 0}static create(){return new nt}calculateVelocity(t){let e,a;if(this.enable_shoot_location)e=this.shoot_location,t.setThrowerLocation(this.shoot_location);else{let a;try{a=this.thrower.location}catch{return!1}e=new b(a.x+this.thrower_offset.x,a.y+this.thrower_offset.y,a.z+this.thrower_offset.z),t.setThrowerOffset(this.thrower_offset)}if(this.enable_target_location)a=this.target_location;else{let t;try{t=this.target.location}catch{return!1}a=new b(t.x+this.target_offset.x,t.y+this.target_offset.y,t.z+this.target_offset.z)}if(x.equals(e,a))return new b(this.velocity,0,0);if(this.pre_judge&&!this.enable_target_location){let t=this.target.getVelocity();this.pre_judge_verticle||(t.y=0);let i=x.add(a,x.multiply(t,5));if(!x.equals(e,i))return x.preJudge(e,i,this.velocity,t)}return x.getVector_speed_direction(this.velocity,new b(a.x-e.x,a.y-e.y,a.z-e.z))}aimedShot(){let t=new rt(this.world,this.thrower).setDamage(this.damage).setGravityVelocity(this.gravity).setDanmakuType(this.type).setColor(this.color);t.setLifeTime(this.lifeTime),void 0!==this.ownerID&&t.setOwnerID(this.ownerID);let e=this.calculateVelocity(t);return!!e&&(t.shoot_bedrock(e,this.inaccuracy),!0)}fanShapedShot(){if(this.yawTotal<0||this.yawTotal>nt.MAX_YAW||this.fanNum<nt.MIN_FAN_NUM)return!1;let t=new rt(this.world,this.thrower).setDamage(this.damage).setGravityVelocity(this.gravity).setDanmakuType(this.type).setColor(this.color);t.setLifeTime(this.lifeTime),void 0!==this.ownerID&&t.setOwnerID(this.ownerID);let e=this.calculateVelocity(t);if(!e)return!1;e=x.normalized(e);let a,i=-this.yawTotal/2,o=this.yawTotal/(this.fanNum-1);a=0==e.y?new b(0,1,0):0===e.x?new b(0,-e.y,e.z):new b(1,-(e.x+e.z*e.z/e.x)/e.y,e.z/e.x),a=x.normalized(a),0!=this.axisRotation&&(a=x.rotate_axis(a,e,this.axisRotation)),0!=this.directionRotation&&(e=x.rotate_axis(e,new b(1,0,-e.x/e.z),this.directionRotation));for(let r=1;r<=this.fanNum;r++){let r=x.rotate_axis(e,a,i);i+=o,t.shoot(r,this.velocity,this.inaccuracy)}return!0}directionShoot(t){new rt(this.world,this.thrower).setDamage(this.damage).setGravityVelocity(this.gravity).setDanmakuType(this.type).setColor(this.color).shoot(t,this.velocity,this.inaccuracy)}setWorld(t){return this.world=t,this}setThrower(t){return this.thrower=t,this}setColor(t){return this.color=t,this}setRandomColor(){return this.color=it.random(),this}setType(t){return this.type=t,this}setRandomType(){return this.type=ot.random(),this}setGravity(t){return this.gravity=t,this}setDamage(t){return this.damage=t,this}setTarget(t){return this.target=t,this}setVelocity(t){return this.velocity=t,this}setInaccuracy(t){return this.inaccuracy=t,this}setYawTotal(t){return this.yawTotal=t,this}setFanNum(t){return this.fanNum=t,this}setThrowerLocation(t){return this.shoot_location=t,this.enable_shoot_location=!0,this}setTargetLocation(t){return this.target_location=t,this.enable_target_location=!0,this}setTargetOffSet(t){return this.target_offset=t,this}setThrowerOffSet(t){return this.thrower_offset=t,this}setAxisRotation_axis(t){return this.axisRotation=t,this}setAxisRotation_direction(t){return this.directionRotation=t,this}setOwnerID(t){return this.ownerID=t,this}setLifeTime(t){return this.lifeTime=t,this}enablePreJudge(){return this.pre_judge=!0,this}enableVerticlePreJudge(){return this.pre_judge_verticle=!0,this}}class st{static Group={};static setDamage(t,e){t.setDynamicProperty("damage",e)}static setTrower(t,e){t.setDynamicProperty("source",e)}static setPiercing(t,e){t.setDynamicProperty("piercing",e)}static setOwner(t,e){t.setDynamicProperty("owner",e)}static applyDamage(t,e,a){try{var o={cause:i.EntityDamageCause.magic};let r=t;if(void 0===r){let t=e.getDynamicProperty("source");if(void 0!==t&&"0"!==t){if(a.id==t)return!1;r=i.world.getEntity(t)}}if(void 0!==r&&(o.damagingEntity=r),a.id==r.id)return!1;if("minecraft:player"===a.typeId){if(void 0!==e.getDynamicProperty("owner"))return!1}else if("thlmm:maid"===a.typeId){let t=X.Owner.getID(a);if(void 0!==t){if(t===e.getDynamicProperty("source"))return!1;if(void 0!==r.id&&t===r.id)return!1}if(void 0!==e.getDynamicProperty("owner"))return!1}let n=a.getComponent("minecraft:rideable");if(void 0!==n)for(let t of n.getRiders())if(t.id===e.getDynamicProperty("source"))return!1;let l=e.getDynamicProperty("damage");if(void 0===l&&(l=s.danmaku_damage),0!==l){switch(r.typeId){case"minecraft:player":l*=s.player_damage/100;break;case"thlmm:maid":l*=s.maid_damage/100;break;case"touhou_little_maid:fairy":l*=s.fairy_damage/100}if(a.applyDamage(l,o))return!0}}catch{}return!1}static addFork(t,e){void 0===this.Group[t]?this.Group[t]=[e]:this.Group[t].push(e)}static getForks(t){return this.Group[t]}static clearForks(t){return void 0!==this.getForks(t)&&(delete this.Group[t],!0)}}const lt=180/Math.PI;function ct(t,e,a,o=9,r=3,n=3){const s=t.dimension;let l=s.spawnEntity("thlmc:danmaku_custom_cherry",e);st.setTrower(l,t.id),st.setPiercing(l,5);let c=x.getEulerAngle(a);l.setProperty("thlm:r_x",lt*c[0]),l.setProperty("thlm:r_y",0),l.setProperty("thlm:r_z",lt*c[1]);var m=128,d={};st.setDamage(l,o);var u=s.getEntitiesFromRay(e,a);for(let e of u)if(d[e.entity.id]=!0,st.applyDamage(t,l,e.entity)&&--n<=0){m=e.distance;break}if(n>0){var h=s.getBlockFromRay(e,a,{includeLiquidBlocks:!1,includePassableBlocks:!1});if(void 0!==h){let t=h.block;m=x.length({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z})}}i.system.runTimeout((()=>{var i=[];st.setDamage(l,r);let o=x.normalized(x.getAnyVerticalVector(a));o.x*=.7,o.y*=.7,o.z*=.7;const n=2*Math.PI/6;for(let t=0;t<6;t++){var c=s.getEntitiesFromRay(x.add(e,o),a,{maxDistance:m});o=x.rotate_axis(o,a,n);for(let t of c)void 0===d[t.entity.id]&&(d[t.entity.id]=!0,i.push(t.entity))}for(let e of i)st.applyDamage(t,l,e)}),1),l.setProperty("thlm:distance",m/2),l.setProperty("thlm:enable",!0)}class mt{static registerCC(t){t.itemComponentRegistry.registerCustomComponent("tlm:gohei_cherry",{onUse(t){let e=t.source;g.damageMainHandStack(e),mt.shoot(e)}})}static shoot(t,e){let a=t.getViewDirection(),i=t.getHeadLocation();ct(t,i,a,9,3,3)}}var dt={};function ut(t){if(void 0!==t&&null!=t.target){let e=x.length({x:t.location.x-t.target.location.x,y:t.location.y-t.target.location.y,z:t.location.z-t.target.location.z})/8,a=.3*(e+1);Math.random()<=.8?nt.create().setWorld(t.dimension).setThrower(t).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,1,0)).setTarget(t.target).setRandomColor().setRandomType().setDamage(e+1).setGravity(0).setVelocity(a).enablePreJudge().setInaccuracy(.05).aimedShot():nt.create().setWorld(t.dimension).setThrower(t).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,1,0)).setTarget(t.target).setRandomColor().setRandomType().setDamage(e+1.5).setGravity(0).setVelocity(a).enablePreJudge().setInaccuracy(.02).setFanNum(3).setYawTotal(Math.PI/6).fanShapedShot()}}var ht=0,gt=.1,ft=!1;function pt(t,e){return function(){!function(t,e){(function(t,e,a){a+=1;for(var i=Math.PI*(3-Math.sqrt(5)),o=[],r=0;r<50;r++){var n=.04*r-1+.02,s=.2*Math.sqrt(1-n*n),l=(r+a)%50*i,c=Math.cos(l)*s,m=Math.sin(l)*s;o.push(new b(c,.2*n,m))}return o})(0,0,t/100).forEach((function(t){e.shoot_bedrock(t,0)}))}(t,e)}}function _t(t,e,a,i){let o=-.01745329251*(i.getRotation().y+e),r=i.location,n=x.rotate_axis(t,new b(0,1,0),o);return n=x.add(n,new b(r.x,r.y+1+a,r.z)),n}function yt(t,e,a,i){let o=-.01745329251*(i.getRotation().y+e),r=i.location,n=x.rotate_axis(t,new b(0,1,0),o);return n=x.add(n,new b(r.x,r.y+1+a,r.z)),n}const kt=[{id:"thlms:border_sign.boundary_between_wave_and_particle",author:"tartaric_acid",version:"1.0.0",cooldown:250,spellCard:function(t,e){for(var a=0;a<120;a++)i.system.runTimeout(function(t){return function(){!function(t){for(var a=0;a<9;a++){var i=new rt(e.dimension,e).setDamage(2).setDanmakuType(ot.PETAL).setColor(it.MAGENTA).setThrowerLocation(new b(e.location.x,e.location.y+1,e.location.z));let o=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(-40*a+5*Math.pow(t/4,2)));i.shoot(o,.4,0)}}(t)}}(a),2*a)}},{id:"thlms:boundary_between_wave_and_particle_3d",author:"snownee",version:"1.0.0",cooldown:150,spellCard:function(t,e){for(var a=0,o=new rt(t,e).setDamage(2).setDanmakuType(ot.PELLET).setColor(it.MAGENTA).setThrowerLocation(new b(e.location.x,e.location.y+1,e.location.z)),r=0;r<30;r++)a+=r,i.system.runTimeout(pt(a,o),4*r)}},{id:"thlms:magic_sign.milky_way",spellCard:function(t,e){for(var a=0;a<50;a++)i.system.runTimeout(function(a){return function(){!function(a){for(var i=0;i<9;i++){var o=new rt(t,e).setDamage(2).setThrowerOffset(new b(0,.8,0)).setDanmakuType(ot.BIG_STAR).setColor(it.RED);a%2==1&&o.setColor(it.BLUE);let r=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(-5*a+40*i));o.shoot(r,.7,0)}}(a)}}(a),5*a);for(a=0;a<20;a++)i.system.runTimeout((()=>{for(var a=0;a<5;a++){var i=_t(new b(-15,0,30*Math.random()-10),0,-.1,e),o=new rt(t,e).setDamage(2).setDanmakuType(ot.STAR).setColor(it.YELLOW);o.setThrowerLocation(i);let a=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y-60));o.shoot(a,.3,0)}}),10*a+50),i.system.runTimeout((()=>{for(var a=0;a<5;a++){var i=_t(new b(15,0,30*Math.random()-10),0,-.1,e),o=new rt(t,e).setDamage(2).setDanmakuType(ot.STAR).setColor(it.GREEN);o.setThrowerLocation(i);let a=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y+60));o.shoot(a,.3,0)}}),10*a+50)}},{id:"thlms:metal_sign.metal_fatigue",author:"tartaric_acid",version:"1.0.0",cooldown:170,spellCard:function(t,e){for(var a=0;a<8;a++){var o=new rt(t,e).setDamage(2).setThrowerOffset(new b(0,.8,0)).setDanmakuType(ot.BIG_BALL).setColor(it.YELLOW);let i=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y+15+45*a));o.setLifeTime(31),o.shoot(i,.2,0)}i.system.runTimeout((()=>{for(var a=0;a<8;a++)for(var i=0;i<8;i++){var o=new rt(t,e).setDamage(2).setThrowerOffset(new b(0,.8,0)).setDanmakuType(ot.BIG_BALL).setColor(it.YELLOW),r=yt(new b(0,0,5.6),15+45*a,-.1,e);o.setThrowerLocation(r);let n=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y+45*i));o.shoot(n,.2,0)}}),30);for(var r=0;r<5;r++)i.system.runTimeout((()=>{for(var a=0;a<8;a++){var i=new rt(t,e).setDamage(2).setThrowerOffset(new b(0,.8,0)).setDanmakuType(ot.BIG_BALL).setColor(it.YELLOW);let o=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y+30+45*a));i.setLifeTime(31),i.shoot(o,.2,0)}}),20*(r+1)),i.system.runTimeout((()=>{for(var a=0;a<8;a++)for(var i=0;i<8;i++){var o=new rt(t,e).setDamage(2).setThrowerOffset(new b(0,.8,0)).setDanmakuType(ot.BIG_BALL).setColor(it.YELLOW),r=yt(new b(0,0,5.6),30+45*a,-.1,e);o.setThrowerLocation(r);let n=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y+30+45*i));o.shoot(n,.2,0)}}),30+20*(r+1))}},{id:"thlms:night_sign.night_bird",author:"tartaric_acid",version:"1.0.0",cooldown:170,spellCard:function(t,e){for(var a=0;a<1;a++)i.system.runTimeout((()=>{for(var a=0;a<16;a++)for(var i=0;i<3;i++){var o=new rt(t,e).setDamage(2).setThrowerOffset(new b(0,.8,0)).setDanmakuType(ot.ORBS).setColor(it.PURPLE);let r=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y+90-8.4375*a-3));o.shoot(r,.04+.04*Math.pow(1.09,15-a+5*i),0)}}),60*a),i.system.runTimeout((()=>{for(var a=0;a<16;a++)for(var i=0;i<3;i++){var o=new rt(t,e).setDamage(2).setThrowerOffset(new b(0,.8,0)).setDanmakuType(ot.ORBS).setColor(it.CYAN);let r=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y-90+8.4375*a));o.shoot(r,.04+.04*Math.pow(1.09,15-a+5*i),0)}}),60*a+15),i.system.runTimeout((()=>{for(var a=0;a<16;a++)for(var i=0;i<3;i++){var o=new rt(t,e).setDamage(2).setThrowerOffset(new b(0,.8,0)).setDanmakuType(ot.ORBS).setColor(it.PURPLE);let r=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y+90-8.4375*a-2));o.shoot(r,.04+.04*Math.pow(1.09,15-a+5*i),0)}}),60*a+30),i.system.runTimeout((()=>{for(var a=0;a<16;a++)for(var i=0;i<3;i++){var o=new rt(t,e).setDamage(2).setThrowerOffset(new b(0,.8,0)).setDanmakuType(ot.ORBS).setColor(it.CYAN);let r=x.rotate_axis(new b(0,0,1),new b(0,-1,0),u(e.getRotation().y-90+8.4375*a-1));o.shoot(r,.04+.04*Math.pow(1.09,15-a+5*i),0)}}),60*a+45)}},{id:"thlms:gossip",spellCard:function(t,e){var a=new rt(e.dimension,e);a.setThrowerOffset(new b(0,.8,0)).setColor(it.RANDOM).setDanmakuType(ot.STAR).setDamage(2);var o=new rt(e.dimension,e);o.setThrowerOffset(new b(0,.8,0)).setColor(it.RANDOM).setDanmakuType(ot.BIG_STAR).setDamage(4);for(let t=0;t<20;t++)i.system.runTimeout((()=>{let t=e.getViewDirection();a.shoot(t,m(.3,1),Math.PI/7),a.shoot(t,m(.3,1),Math.PI/7),a.shoot(t,m(.3,1),Math.PI/7),o.shoot(t,m(.3,1),Math.PI/15),o.shoot(t,m(.3,1),Math.PI/15)}),2*t)}}];class wt{static registerCC(t){t.itemComponentRegistry.registerCustomComponent("tlm:spell_card",{onUse(t){wt.onSpellCardUseEvent(t)}})}static onSpellCardUseEvent(t){let e=t.itemStack,a=t.source;for(let t of kt)if(t.id==e.typeId)return t.spellCard(a.dimension,a),e.getComponent("cooldown").startCooldown(a),!0;return!1}}new class{constructor(){this.map={}}register(t){this.map[t.id]=t.shoot}itemShootEvent(t){let e=t.itemStack,a=t.source,i=this.map[e.typeId],o=e.getComponent("minecraft:cooldown"),r=o.getCooldownTicksRemaining(a);return!(o.cooldownTicks-r>1||void 0===i||(i(a,e),0))}};class vt{static getBlockEntity(t){return t.dimension.getEntities({type:"touhou_little_maid:gold_microwaver",closest:!0,maxDistance:.5,location:{x:t.location.x+.5,y:t.location.y,z:t.location.z+.5}})[0]}static registerCC(t){t.blockComponentRegistry.registerCustomComponent("tlm:microwaver",{onPlace(t){if(t.block.permutation.getState("thlm:first_place"))switch(t.block.setPermutation(t.block.permutation.withState("thlm:door",!1).withState("thlm:item",0).withState("thlm:status",!1).withState("thlm:first_place",!1)),t.block.permutation.getState("minecraft:cardinal_direction")){case"north":f.runCommand(t.block,"summon touhou_little_maid:gold_microwaver ~~~ ~~ North");break;case"south":f.runCommand(t.block,"summon touhou_little_maid:gold_microwaver ~~~ ~~ South");break;case"east":f.runCommand(t.block,"summon touhou_little_maid:gold_microwaver ~~~ ~~ East");break;case"west":f.runCommand(t.block,"summon touhou_little_maid:gold_microwaver ~~~ ~~ West")}},onPlayerDestroy(t){vt.getBlockEntity(t.block).triggerEvent("thlmw:d")},onPlayerInteract(t){let e=t.player;if(void 0===g.getPlayerMainHand(e)){let a=vt.getBlockEntity(t.block);if(void 0===a)return;e.isSneaking?a.triggerEvent("thlmw:s"):a.triggerEvent("thlmw:i")}else vt.interactEvent(t.block,t.player)}})}static recipes=[void 0,{material:"touhou_little_maid:dragon_skull",result:"touhou_little_maid:magic_powder",max:1,time:180},{material:"minecraft:chicken",result:"minecraft:cooked_chicken",max:128,time:128},{material:"minecraft:porkchop",result:"minecraft:cooked_porkchop",max:128,time:128},{material:"minecraft:beef",result:"minecraft:cooked_beef",max:128,time:128},{material:"minecraft:mutton",result:"minecraft:cooked_mutton",max:128,time:128},{material:"minecraft:rabbit",result:"minecraft:cooked_rabbit",max:128,time:128},{material:"minecraft:cod",result:"minecraft:cooked_cod",max:128,time:128},{material:"minecraft:salmon",result:"minecraft:cooked_salmon",max:128,time:128},{material:"minecraft:potato",result:"minecraft:baked_potato",max:128,time:128},{material:"minecraft:kelp",result:"minecraft:dried_kelp",max:128,time:128},{material:"minecraft:chorus_fruit",result:"minecraft:popped_chorus_fruit",max:128,time:128}];static getRecipeIndexByMaterial(t){if(void 0===t)return 0;for(let e=1;e<this.recipes.length;e++)if(this.recipes[e].material===t)return e;return 0}static getEntityByBlock(t){let e=t.location;e.x+=.5,e.z+=.5;const a=t.dimension.getEntities({type:"touhou_little_maid:gold_microwaver",maxDistance:.5,location:e});if(0!==a.length)return a[0]}static getBlockByEntity(t){return t.dimension.getBlock(t.location)}static Entity={getItem:t=>t.getProperty("thlm:item"),setItem(t,e){if(!this.getDoor(t))return!1;let a=this.getItem(t);0!==a&&this.getProgress(t)<1&&this.spawnItem(t,vt.recipes[a].material,this.getAmount(t)),t.setProperty("thlm:item",e),t.setProperty("thlm:time",0),t.setProperty("thlm:progress",0);let i=vt.recipes[e];return t.setProperty("thlm:total_time",void 0===i?0:i.time),!0},getAmount:t=>t.getProperty("thlm:amount"),setAmount(t,e){t.setProperty("thlm:amount",e)},getDoor:t=>void 0!==t.getComponent("minecraft:is_baby"),setDoor(t,e){t.triggerEvent(e?"door_open":"door_close")},setStatus(t,e){t.triggerEvent(e?"activate":"deactivate")},getStatus:t=>t.getProperty("thlm:status"),getProgress:t=>t.getProperty("thlm:progress"),setProgress(t,e){t.setProperty("thlm:progress",e)},spawnItem(t,e,a=1){let o=a;for(;;){if(o<=64)return void t.dimension.spawnItem(new i.ItemStack(e,o),t.location);t.dimension.spawnItem(new i.ItemStack(e,64),t.location),o-=64}}};static Block={setStatus(t,e){t.setPermutation(t.permutation.withState("thlm:status",e))},setDoor(t,e){t.setPermutation(t.permutation.withState("thlm:door",e))}};static placeEvent(t){let e=t.block.location;switch(t.blockFace){case i.Direction.Down:e.y--;break;case i.Direction.Up:e.y++;break;case i.Direction.East:e.x++;break;case i.Direction.West:e.x--;break;case i.Direction.South:e.z++;break;case i.Direction.North:e.z--;break;default:return}let a=t.source,o=a.dimension;if(!o.getBlock(e).isAir)return;let r=a.getViewDirection(),n=x.getDirectionByView2D(r),s=0;switch(n){case i.Direction.North:s=1;break;case i.Direction.East:s=2;break;case i.Direction.South:s=3;break;case i.Direction.West:s=4;break;default:return}o.fillBlocks(new i.BlockVolume(e,e),i.BlockPermutation.resolve("touhou_little_maid:gold_microwaver",{"thlm:direction":s,"thlm:door":!1,"thlm:item":0,"thlm:status":!1})),e.x+=.5,e.z+=.5,o.spawnEntity("touhou_little_maid:gold_microwaver",e).triggerEvent(n);let l=a.getComponent("inventory").container,c=a.selectedSlotIndex;if(1===t.itemStack.amount)l.setItem(c);else{let t=l.getItem(c);t.amount--,l.setItem(c,t)}t.cancel=!0}static interactEvent(t,e){let a=this.getEntityByBlock(t);this.interactBaseEvent(a,t,e)}static interactEventNoItem(t){let e=t.entity,a=this.getBlockByEntity(e);this.interactBaseEvent(e,a,void 0,!1)}static interactEventNoItemSneaking(t){let e=t.entity,a=this.getBlockByEntity(e);this.interactBaseEvent(e,a,void 0,!0)}static interactBaseEvent(t,e,a,i=!1){let o=void 0===a?i:a.isSneaking;if(this.Entity.getStatus(t))this.Entity.setStatus(t,!1),this.Block.setStatus(e,!1),o&&(this.Entity.setDoor(t,!0),this.Block.setDoor(e,!0));else if(this.Entity.getDoor(t)){let i=this.Entity.getItem(t);if(0!==i){let r=this.Entity.getProgress(t);if(r<=0)if(o)this.Entity.setItem(t,0),this.Entity.setAmount(t,0);else{let o=!1;if(void 0!==a){let e=g.getPlayerMainHand(a);if(i===this.getRecipeIndexByMaterial(e.typeId)){let r=this.Entity.getAmount(t),n=this.recipes[i];if(r<n.max){o=!0;let i=Math.min(n.max-r,e.amount);g.setPlayerMainHand(a,e.amount-i==0?void 0:(e.amount-=i,e)),this.Entity.setAmount(t,r+i)}}}o||(this.Entity.setDoor(t,!1),this.Block.setDoor(e,!1),this.Entity.setStatus(t,!0),this.Block.setStatus(e,!0))}else r>=1?(this.Entity.spawnItem(t,this.recipes[i].result,this.Entity.getAmount(t)),this.Entity.setItem(t,0),this.Entity.setAmount(t,0)):o?(this.Entity.setItem(t,0),this.Entity.setAmount(t,0)):(this.Entity.setStatus(t,!0),this.Block.setStatus(e,!0),this.Entity.setDoor(t,!1),this.Block.setDoor(e,!1))}else if(o||void 0===a)this.Entity.setDoor(t,!1),this.Block.setDoor(e,!1);else{let i=g.getPlayerMainHand(a),o=this.getRecipeIndexByMaterial(i.typeId);if(0!==o){this.Entity.setItem(t,o);let e=this.recipes[o],r=Math.min(i.amount,e.max);g.setPlayerMainHand(a,i.amount-r==0?void 0:(i.amount-=r,i)),this.Entity.setAmount(t,r)}else this.Entity.setDoor(t,!1),this.Block.setDoor(e,!1)}}else 0===this.Entity.getItem(t)||this.Entity.getProgress(t)>=1||o?(this.Entity.setDoor(t,!0),this.Block.setDoor(e,!0)):(this.Entity.setStatus(t,!0),this.Block.setStatus(e,!0))}static despawnEvent(t){let e=t.entity;e.triggerEvent("despawn");let a=this.recipes[this.Entity.getItem(e)];void 0!==a&&(this.Entity.getProgress(e)>=1?this.Entity.spawnItem(e,a.result,this.Entity.getAmount(e)):this.Entity.spawnItem(e,a.material,this.Entity.getAmount(e)))}static finishEvent(t){let e=t.entity,a=this.getBlockByEntity(e);void 0!==a&&this.Block.setStatus(a,!1)}}function bt(t,e,a=!0){1===s.ui_enable?new It(t,e).skinpackSelection(a):new xt(t,e).skinpackSelection(a)}class xt{constructor(t,e){this.player=t,this.maid=e,this.maid_name=X.getNameTag(e),""===this.maid_name&&(this.maid_name={translate:"entity.touhou_little_maid:maid.name"})}main(){let t,e=X.Health.getComponent(this.maid),a=X.Work.get(this.maid),o=X.Home.getMode(this.maid),r=X.Pick.get(this.maid),n=X.Mute.get(this.maid),s=X.Backpack.getInvisible(this.maid),l=X.Skin.getPack(this.maid),c=X.Skin.getIndex(this.maid);t=C.getSkinDisplayName(l,c),(new at.ActionFormData).title(this.maid_name).body(` | §6Lv.${X.Level.get(this.maid)}§r | ${String.fromCodePoint(58885)} ${e.currentValue.toFixed(0)}/${e.defaultValue} | ${String.fromCodePoint(58889)} ${X.Kill.get(this.maid)} |`).button({rawtext:[{translate:"gui.touhou_little_maid:task.switch.name"},{text:" | "},{translate:X.Work.getLang(a)}]},X.Work.getIMG(a)).button({translate:X.Home.getLang(o)},X.Home.getImg(o)).button({rawtext:[{translate:s?"gui.touhou_little_maid:button.backpack.true.name":"gui.touhou_little_maid:button.backpack.false.name"}]},X.Backpack.getButtonImg(s)).button({rawtext:[{translate:r?"gui.touhou_little_maid:button.pickup.true.name":"gui.touhou_little_maid:button.pickup.false.name"}]},X.Pick.getImg(r)).button({rawtext:[{translate:n?"gui.touhou_little_maid:button.mute.true.name":"gui.touhou_little_maid:button.mute.false.name"}]},X.Mute.getImg(r)).button({rawtext:[{translate:"gui.touhou_little_maid:button.skin.name"},{text:" | "},t]},C.getPackIcon(l)).show(this.player).then((t=>{switch(t.selection){case 0:this.workSelection();break;case 1:X.Home.switchMode(this.maid),i.system.runTimeout((()=>{this.main()}),1);break;case 2:X.Backpack.setInvisible(this.maid,!s);break;case 3:X.Pick.set(this.maid,!r),i.system.runTimeout((()=>{this.main()}),1);break;case 4:X.Mute.switchMode(this.maid),i.system.runTimeout((()=>{this.main()}),1);break;case 5:this.skinpackSelection()}}))}workSelection(){const t=(new at.ActionFormData).title(this.maid_name).body("工作模式");for(let e=0;e<X.Work.AMOUNT;e++)t.button(X.Work.getLang(e),X.Work.getIMG(e));t.show(this.player).then((t=>{void 0!==t.selection&&(X.Work.set(this.maid,t.selection),i.system.runTimeout((()=>{this.main()}),2))}))}skinpackSelection(t=!0){const e=(new at.ActionFormData).title(this.maid_name).body({rawtext:[{translate:"gui.touhou_little_maid:button.skin.name"}]});C.SkinList;let a=0;for(;a<C.DEFAULTAMOUNT;a++)e.button(C.getPackDisplayName(a),C.getPackIcon(a));for(;a<C.length();a++)e.button(C.getPackDisplayName(a+100),C.getPackIcon(a+100));e.show(this.player).then((e=>{if(void 0!==e.selection){let a=e.selection<C.DEFAULTAMOUNT?e.selection:e.selection+100;t?this.skinindexSelection(a):X.Skin.setPack(this.maid,a)}}))}skinindexSelection(t){const e=(new at.ActionFormData).title(C.getPackDisplayName(t)).body({rawtext:[{translate:"gui.touhou_little_maid.author.name"},C.getAuthors(t)]});for(let a=0;a<C.getSkinAmount(t);a++)e.button(C.getSkinDisplayName(t,a));e.show(this.player).then((e=>{void 0!==e.selection&&(X.Skin.setPack(this.maid,t),X.Skin.setIndex(this.maid,e.selection))}))}}class It{constructor(t,e){this.player=t,this.maid=e,this.maid_name=X.getNameTag(e)}main(){let t,e=""===this.maid_name?{rawtext:[{text:`/M ${X.Level.getStr(this.maid)} `},{translate:"entity.touhou_little_maid:maid.name"}]}:`/M ${X.Level.getStr(this.maid)} `+this.maid_name,a=X.Health.getComponent(this.maid),o=X.Work.get(this.maid),r=X.Home.getMode(this.maid),n=X.Pick.get(this.maid),s=X.Mute.get(this.maid),l=X.Backpack.getInvisible(this.maid),c=X.Skin.getPack(this.maid),m=X.Skin.getIndex(this.maid);t=C.getSkinDisplayName(c,m);const d=(new at.ActionFormData).title(e).body(this.maid.id).button(`${String.fromCodePoint(58885)} ${a.currentValue.toFixed(0)}/${a.defaultValue}\n${String.fromCodePoint(58889)} ${X.Kill.get(this.maid)} `).button({translate:X.Home.getLang(r)},X.Home.getImg(r)).button({translate:X.Pick.getLang(n)},X.Pick.getImg(n)).button({translate:X.Ride.getLang(!1)},X.Ride.getImg(!1)).button(X.Backpack.getButtonLang(l),X.Backpack.getButtonImg(l)).button({translate:X.Mute.getLang(n)},X.Mute.getImg(s)).button({rawtext:[{translate:"gui.touhou_little_maid:button.skin.name"},{text:" | "},t]},"textures/gui/maid_skin.png");for(let t=0;t<X.Work.AMOUNT;t++)t===o?d.button({rawtext:[{text:"§a"},{translate:X.Work.getLang(t)}]},X.Work.getIMG(t)):d.button({translate:X.Work.getLang(t)},X.Work.getIMG(t));d.show(this.player).then((t=>{if(void 0!==t.selection)switch(t.selection){case 0:break;case 1:X.Home.switchMode(this.maid),i.system.runTimeout((()=>{this.main()}),1);break;case 2:X.Pick.set(this.maid,!n),i.system.runTimeout((()=>{this.main()}),1);break;case 3:X.Ride.switchMode(this.maid),i.system.runTimeout((()=>{this.main()}),1);break;case 4:X.Backpack.setInvisible(this.maid,!l),i.system.runTimeout((()=>{this.main()}),1);break;case 5:X.Mute.set(this.maid,!s),i.system.runTimeout((()=>{this.main()}),1);break;case 6:this.skinpackSelection();break;default:X.Work.set(this.maid,t.selection-7),i.system.runTimeout((()=>{this.main()}),2)}}))}skinpackSelection(t=!0){let e=""===this.maid_name?{rawtext:[{translate:"entity.touhou_little_maid:maid.name"}]}:this.maid_name;const a=(new at.ActionFormData).title(e).body({rawtext:[{translate:"gui.touhou_little_maid:button.skin.name"}]});C.SkinList;let i=0;for(;i<C.DEFAULTAMOUNT;i++)a.button(C.getPackDisplayName(i),C.getPackIcon(i));for(;i<C.length();i++)a.button(C.getPackDisplayName(i+100),C.getPackIcon(i+100));a.show(this.player).then((e=>{if(void 0!==e.selection){let a=e.selection<C.DEFAULTAMOUNT?e.selection:e.selection+100;t?this.skinindexSelection(a):X.Skin.setPack(this.maid,a)}}))}skinindexSelection(t){const e=(new at.ActionFormData).title(C.getPackDisplayName(t)).body({rawtext:[{translate:"gui.touhou_little_maid.author.name"},C.getAuthors(t)]});for(let a=0;a<C.getSkinAmount(t);a++)e.button(C.getSkinDisplayName(t,a));e.show(this.player).then((e=>{void 0!==e.selection&&(X.Skin.setPack(this.maid,t),X.Skin.setIndex(this.maid,e.selection))}))}}const St=["minecraft:frame","minecraft:glow_frame","minecraft:decorated_pot"];function Et(t){return St.includes(t)}class Tt{static Core=class{static init(){}static onSpawnEvent(t){let e=t.entity;e.triggerEvent("api:init_success"),X.init_maid(e)}static onDeathEvent(t){let e=t.entity;if(void 0===e)return;let a=X.toLore(e,!1),o=new i.ItemStack("touhou_little_maid:film",1);o.setLore(a);let r=e.dimension.spawnEntity("touhou_little_maid:tombstone",e.location),n=r.getComponent("inventory").container,s=e.getComponent("inventory").container;for(let t=0;t<s.size;t++){let e=s.getItem(t);void 0!==e&&(n.setItem(t,e),s.setItem(t))}n.addItem(o);let l=X.Owner.getName(e);void 0!==l&&(r.nameTag="§aOwner\n§e"+l,V(r,"owner_name",l));let c=X.Owner.getID(e);void 0!==c&&V(r,"owner_id",c)}static onTamed(t){let e=t.entity;X.Level.eventTamed(e,X.Level.get(e)),X.Owner.refresh(e);let a=e.getDynamicProperty("temp_work");void 0!==a&&(X.Work.set(e,a),e.setDynamicProperty("temp_work")),X.Sound.tamed(e)}static tombstoneAttackEvent(t){let e=t.entity,a=e.dimension,o=A(e,"owner_name");if(void 0!==o&&0===a.getPlayers({name:o,location:e.location,maxDistance:6}).length){let t=A(e,"owner_id");if(void 0!==t){let a=i.world.getEntity(t);if(x.length(x.sub(a.location,e.location))>6)return}}let r=e.getComponent("inventory").container;for(let t=0;t<r.size;t++){let i=r.getItem(t);void 0!==i&&(a.spawnItem(i.clone(),e.location),r.setItem(t))}e.triggerEvent("despawn")}};static Interact=class{static onInteractEvent(t){let e=t.entity,a=X.Owner.getID(e);return void 0!==a&&(function(t,e){1===s.ui_enable?new It(t,e).main():new xt(t,e).main()}(i.world.getEntity(a),t.entity),!0)}static onPhotoEvent(t){let e=t.entity;if(void 0===e)return;let a=X.Owner.get(e);if(void 0===a)return;let o=X.toLore(e);X.playSound(e,"thlm.camera_use"),e.location.y+=.5;let r=new i.ItemStack("touhou_little_maid:photo",1);r.setLore(o);let n=X.getNameTag(e);""!==n&&(r.nameTag=`§z${n}`),void 0!==e.dimension.spawnItem(r,a.location)&&(X.Pick.set(e,!1),e.triggerEvent("despawn"))}static getSafeLocation(t,e,a){let o=e;switch(a){case i.Direction.Down:o.y--;break;case i.Direction.Up:o.y++;break;case i.Direction.East:o.x++;break;case i.Direction.West:o.x--;break;case i.Direction.South:o.z++;break;case i.Direction.North:o.z--;break;default:return}if(!X.isSafeBlock(t.getBlock(o)))return;const r=new b(o.x,o.y+1,o.z);if(!X.isSafeBlock(t.getBlock(r))){const e=new b(o.x,o.y-1,o.z);return X.isSafeBlock(t.getBlock(o))?e:void 0}return o}static photoOnUseEvent(t){let e=t.itemStack.getLore();if(0===e.length)return;if(Et(t.block.typeId))return;const a=t.source,i=a.dimension;let o=this.getSafeLocation(i,t.block.location,t.blockFace);if(void 0===o)return void w(a.name,"message.touhou_little_maid:photo.not_suitable_for_place_maid.name");o.x+=.5,o.z+=.5;let r=y(e);T.Owner.getId(r)===t.source.id&&(X.fromStr(r,i,o,!0),g.setPlayerMainHand(t.source))}static smartSlabOnUseEvent(t){let e=t.itemStack,a=e.getLore();if(Et(t.block.typeId))return;const o=t.source,r=o.dimension;let n,s=this.getSafeLocation(r,t.block.location,t.blockFace);if(void 0===s)return void w(o.name,"message.touhou_little_maid:photo.not_suitable_for_place_maid.name");s.x+=.5,s.z+=.5;let l=e.nameTag;if(0===a.length){n=X.spawnRandomMaid(r,s);try{X.Skin.setRandom(n),i.system.runTimeout((()=>{X.Owner.set(n,o)}),1)}catch{}}else try{let e=y(a);if(T.Owner.getId(e)!==t.source.id)return;n=X.fromStr(e,r,s,!0)}catch{}if(void 0===n)return;let c=new i.ItemStack("touhou_little_maid:smart_slab_empty",1);void 0!==l&&"§z"!==l.substring(0,2)&&(c.nameTag=l),g.setPlayerMainHand(t.source,c)}static onSmartSlabRecycleEvent(t){let e=t.entity;if(void 0===e)return;let a=X.Owner.get(e);if(void 0===a)return;let o=g.getPlayerMainHand(a);if(void 0===o||"touhou_little_maid:smart_slab_empty"!==o.typeId)return;let r=X.toLore(e);X.Pick.set(e,!1),e.triggerEvent("despawn");let n=new i.ItemStack("touhou_little_maid:smart_slab_has_maid",1);if(void 0===o.nameTag){let t=X.getNameTag(e);""!==t&&(n.nameTag=`§z${t}`)}else""!==o.nameTag.substring(0,2)&&(n.nameTag=o.nameTag);n.setLore(r),g.setPlayerMainHand(a,n)}static onSitEvent(t){let e=t.entity;switch(X.Work.get(e)){case X.Work.attack:case X.Work.farm:case X.Work.sugar_cane:case X.Work.melon:case X.Work.cocoa:X.Work.quit(e)}X.Pick.get(e)&&X.Pick.set(e,!0)}static onStandEvent(t){let e=t.entity;switch(X.Work.get(e)){case X.Work.attack:X.Work.enter(e,X.Work.attack);break;case X.Work.farm:X.Work.enter(e,X.Work.farm);break;case X.Work.sugar_cane:X.Work.enter(e,X.Work.sugar_cane);break;case X.Work.melon:X.Work.enter(e,X.Work.melon);break;case X.Work.cocoa:X.Work.enter(e,X.Work.cocoa)}q.search(e,15),X.Pick.get(e)&&X.Pick.set(e,!0)}static sitModeEvent(t){let e=t.entity;X.Backpack.quitCheckMode(e),X.Emote.set(e,0)}static inventoryModeEvent(t){let e=t.entity;X.Backpack.checkMode(e),X.Emote.backpack(e)}static backpackTypeChangeEvent(t,e){let a=t.entity,o=X.Backpack.getType(a),r=a.dimension,n=a.location;if(o>e){let t=X.Backpack.getContainer(a);for(let a=X.Backpack.getCapacity(e);a<X.Backpack.getCapacity(o);a++){let e=t.getItem(a);void 0!==e&&(r.spawnItem(e,n),t.setItem(a))}}X.Backpack.setType(a,e),i.system.runTimeout((()=>{X.Emote.backpack(a)}),1),0!==o&&r.spawnItem(new i.ItemStack(X.Backpack.getItemName(o),1),n)}};static Shedule=class{static returnHomeEvent(t){let e=t.entity,a=-1===X.Work.get(e)?2:32,o=X.Home.getLocation(e);if(void 0===o)return void X.Home.setLocation(e);let r=e.dimension.id===o[3];r&&(r=function(t,e,a,i,o,r){if(a<o){if(t<a||o<t)return!1}else if(t<o||a<t)return!1;if(i<r){if(e<i||r<e)return!1}else if(e<r||i<e)return!1;return!0}(e.location.x,e.location.z,o[0]-a,o[2]-a,o[0]+a,o[2]+a)),i.world.getDimension(o[3]),r||e.teleport(new b(o[0],o[1],o[2]),{dimension:i.world.getDimension(o[3])})}static timerEvent(t){let e=t.entity;if(void 0===e)return;let a=e.getDynamicProperty("step");if(void 0===a)return void e.setDynamicProperty("step",0);a>=1e3?e.setDynamicProperty("step",0):e.setDynamicProperty("step",a+1),e.getProperty("thlm:is_hug")&&Tt.Hug.maidScan(e);let o=X.Work.get(e);switch(o){case X.Work.farm:case X.Work.melon:case X.Work.cocoa:q.stepEvent(e,o)}!1===i.world.gameRules.mobGriefing&&!0===X.Pick.get(e)&&i.system.runTimeout((()=>{X.Pick.magnet(e,5)}),2);try{if(a%3==0){try{let t=X.Health.getComponent(e);if(t.currentValue<t.defaultValue){let a=X.Level.getProperty(e,"heal");t.setCurrentValue(Math.min(t.defaultValue,t.currentValue+d(a[0],a[1])))}}catch{}try{X.isSitting(e)||q.search(e,15)}catch{}}else a%11==0&&(X.Mute.get(e)||i.system.runTimeout((()=>{try{X.playSound(e,"mob.thlmm.maid.idle")}catch{}}),d(0,100)))}catch{}}static killEvent(t){let e=t.damageSource.damagingEntity,a=X.Kill.get(e);X.Kill.set(e,a+1)}static danmakuAttack(t){let e=t.entity;if(void 0===e)return;let a=e.target;if(null!=a){let t=X.Level.getProperty(e,"danmaku");if("minecraft:phantom"===a.typeId){let i=e.getHeadLocation(),o=new b(a.location.x-i.x,a.location.y-i.y,a.location.z-i.z);return void ct(e,i,o,t,t/3,1)}let n=x.length(new b(e.location.x-e.target.location.x,e.location.y-e.target.location.y,e.location.z-e.target.location.z)),s=n/8,l=n<5?.2:.5;if(e.dimension.getEntities({location:e.location,families:["monster"],maxDistance:20}).length>4){const a=3,n=.8;switch(d(0,1)){case 0:{let o=nt.create().setWorld(e.dimension).setThrower(e).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,l,0)).setOwnerID(X.Owner.getID(e)).setRandomColor().setRandomType().setDamage((s+t+.5)*n/a).setGravity(0).setVelocity(.5*(s+1)).setInaccuracy(.02).setFanNum(12).setYawTotal(Math.PI/2).setLifeTime(30);for(let t=0;t<a;t++)i.system.runTimeout((()=>{o.setTarget(e.target).setRandomColor().setRandomType().fanShapedShot()}),20*t)}break;case 1:var o=nt.create().setWorld(e.dimension).setThrower(e).setTarget(e.target).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,l,0)).setColor(it.RANDOM).setType(ot.STAR).setDamage((s+t+.5)*n/18).setGravity(0).setLifeTime(40).setVelocity(.5*(s+1)).setInaccuracy(Math.PI/7),r=nt.create().setWorld(e.dimension).setThrower(e).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,l,0)).setLifeTime(45).setColor(it.RANDOM).setType(ot.BIG_STAR).setDamage((s+t+.5)*n/10).setGravity(0).setVelocity(.5*(s+1)).setInaccuracy(Math.PI/15);for(let t=0;t<5;t++)i.system.runTimeout((()=>{r.setTarget(e.target).setVelocity(m(.3,1)).aimedShot()}),8*t),i.system.runTimeout((()=>{o.setTarget(e.target).setVelocity(m(.3,1)).aimedShot()}),1+8*t),i.system.runTimeout((()=>{o.setTarget(e.target).setVelocity(m(.3,1)).aimedShot()}),2+8*t),i.system.runTimeout((()=>{r.setTarget(e.target).setVelocity(m(.3,1)).aimedShot()}),3+8*t),i.system.runTimeout((()=>{o.setTarget(e.target).setVelocity(m(.3,1)).aimedShot()}),4+8*t)}}else{const a=4;let o=nt.create().setWorld(e.dimension).setThrower(e).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,l,0)).setOwnerID(X.Owner.getID(e)).setDamage((s+t)/a).setGravity(0).setVelocity(.5*(s+1)).enablePreJudge().setInaccuracy(.05);for(let t=0;t<a;t++)i.system.runTimeout((()=>{o.setTarget(e.target).setRandomColor().setRandomType().aimedShot()}),12*t)}}}};static Hug=class{static startEvent(t){Tt.Interact.onSitEvent(t);let e=t.entity,a=X.Owner.get(e);e.dimension;let o=a.getComponent("rideable");0==o.getRiders().length&&(e.triggerEvent("api:sit_to_hug"),i.system.runTimeout((()=>{o.addRider(e)?(this.summonInteractEntity(e,a),e.setProperty("thlm:is_hug",!0),this.startAnimate(a)):e.triggerEvent("api:hug_to_sit")}),1))}static summonInteractEntity(t,e){let a=e.dimension.spawnEntity("touhou_little_maid:hug_maid",new b(e.location.x,-60,e.location.z));a.getComponent("tameable").tame(e),t.getComponent("rideable").addRider(a),a.setDynamicProperty("maid",t.id)}static stopEvent(t){let e=t.entity.getDynamicProperty("maid");if(void 0===e)return void t.entity.remove();let a=i.world.getEntity(e);void 0!==a?this.stop(a):t.entity.remove()}static stop(t){let e=t.getComponent("rideable").getRiders();0!==e.length&&e[0].remove(),t.triggerEvent("api:hug_to_sit"),t.setProperty("thlm:is_hug",!1);let a=X.Owner.get(t);void 0!==a&&(this.stopAnimate(a),a.getComponent("rideable").ejectRider(t))}static seatScan(t){try{let e=t.entity;if(void 0===e)return;0===e.dimension.getEntities({location:e.location,maxDistance:1,families:["maid"]}).length&&e.remove()}catch{}}static maidScan(t){let e=X.Owner.get(t),a=!0;if(void 0!==e)for(let i of e.getComponent("rideable").getRiders())if(i.id===t.id){a=!1;break}a?this.stop(t):0===t.getComponent("rideable").getRiders().length&&this.summonInteractEntity(t,e)}static stopAnimate(t){t.runCommand("playanimation @s animation.thlm.player.hug_maid_stop animation.thlm.player.hug_maid_stop")}static startAnimate(t){t.runCommand("playanimation @s animation.thlm.player.hug_maid animation.thlm.player.hug_maid 9999"),t.runCommand("playanimation @s animation.thlm.player.hug_maid")}};static boxOpenEvent(t){let e=t.entity;X.spawnRandomMaid(e.dimension,e.location),X.playSound(e,"thlm.box"),e.triggerEvent("despawn")}static setLevelEvent(t){let e=t.entity;if(void 0===e)return;let a=parseInt(t.id.substring(7));X.Level.set(e,a)}static onNPCEvent(t){let e=t.entity;void 0!==e&&(X.Home.setLocation(e),X.Emote.clear(e))}static NPCInteract(t){let e=t.entity;if(void 0===e)return;let a=e.dimension.getPlayers({location:e.location,maxDistance:6});for(let t of a){let a=g.getPlayerMainHand(t);if(void 0!==a&&"touhou_little_maid:npc_tool"===a.typeId)return void bt(t,e,!1)}}}class Dt{static scriptEvent(t){switch(t.id){case"thlm:skin_set":this.setSkin(t);break;case"thlm:config":this.config(t);break;case"thlm:admin":this.admin(t);break;case"thlm:test":this.test(t);break;case"thlm:info":this.info(t);break;case"thlm:mg":this.memorizableGensokyo(t);break;case"thlm:mg_get":this.memorizableGensokyo_get(t);break;case"thlm:debug":this.debug(t)}}static memorizableGensokyo(t){let e=t.sourceEntity,a="";for(let e=0;e<t.message.length;e++)a+="§"+t.message[e];let i=g.getPlayerMainHand(e),o=`§t§l§m§m§g${a}`;i.setLore([o]),g.setPlayerMainHand(e,i),e.sendMessage(o.replace(new RegExp("§","g"),"*"))}static memorizableGensokyo_get(t){let e=t.sourceEntity,a=g.getPlayerMainHand(e);e.sendMessage(a.getLore()[0].replace(new RegExp("§","g"),""))}static setSkin(t){let e=t.message.split(","),a=[];for(let t of e)c(t),a.push(parseInt(t));C.setSkin(a),c(`Add skin: ${a}`)}static config(t){try{let e=t.message.split(":");if(1===e.length)"show"===t.message?void 0!==t.sourceEntity&&t.sourceEntity.runCommand(`tellraw @s {"rawtext":[{"text": "${l.tostring()}"}]}`):c("Unknown config command.");else{let t=parseInt(e[1]);l.set(e[0],t),c(`Config set: ${e[0]} - ${t}`)}}catch{c("Invalid config command.")}}static admin(t){switch(t.message){case"iteminfo":{let e=t.sourceEntity;if(void 0===e||"minecraft:player"!==e.typeId)return;let a=g.getPlayerMainHand(e);if(void 0===a)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.item.void"}]});switch(a.typeId){case"touhou_little_maid:smart_slab_has_maid":case"touhou_little_maid:photo":case"touhou_little_maid:film":let t=y(a.getLore());e.sendMessage({rawtext:T.formatOutput(t)});break;default:return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.item.not_supported"}]})}}break;case"maidinfo":{let e=t.sourceEntity;if(void 0===e||"minecraft:player"!==e.typeId)return;let a=e.dimension.getEntities({location:e.location,type:"thlmm:maid",closest:1})[0];if(void 0===a)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.maid.not_found"}]});e.sendMessage({rawtext:X.formatOutput(a)})}break;default:if("setm"===t.message.substring(0,4)){let e=t.sourceEntity;if(void 0===e||"minecraft:player"!==e.typeId)return;let a=e.dimension.getEntities({location:e.location,type:"thlmm:maid",closest:1})[0];if(void 0===a)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.maid.not_found"}]});let o=t.message.substring(4);if(o=o.split(":"),2!==o.length)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.lack_colon"}]});switch(o[0]){case"owner":X.Owner.setName(a,o[1]),e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.owner.success"},{text:o[1]}]});break;case"level":{let t;try{t=parseInt(o[1])}catch{}if("number"!=typeof t||isNaN(t)||t<1||t>X.Level.max)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.level.out_of_range"}]});X.Level.set(a,t),e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.level.success"},{text:t.toString()}]})}break;case"kill":{let t=parseInt(o[1]);if(void 0===t||t<0)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.kill.out_of_range"}]});X.Kill.set(a,t),e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.kill.success"},{text:o[1]}]})}break;default:{let t="owner, level, kill";return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.invalid"},{text:t}]})}}i.system.runTimeout((()=>{e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.after"}]}),e.sendMessage({rawtext:X.formatOutput(a)})}),2)}else if("seti"===t.message.substring(0,4)){let e=t.sourceEntity;if(void 0===e||"minecraft:player"!==e.typeId)return;let a=g.getPlayerMainHand(e);if(void 0===a)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.item.void"}]});switch(a.typeId){case"touhou_little_maid:smart_slab_has_maid":case"touhou_little_maid:photo":case"touhou_little_maid:film":{let i=y(a.getLore()),o=t.message.substring(4);if(o=o.split(":"),2!==o.length)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.lack_colon"}]});switch(o[0]){case"owner":i=T.Str.setOwnerName(i,o[1]),e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.owner.success"},{text:o[1]}]});break;case"level":{let t;try{t=parseInt(o[1])}catch{}if("number"!=typeof t||isNaN(t)||t<1||t>X.Level.max)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.level.out_of_range"}]});i=T.Level.set(i,t),e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.level.success"},{text:t.toString()}]})}break;case"kill":{let t=parseInt(o[1]);if(void 0===t||t<0)return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.kill.out_of_range"}]});i=T.Kill.set(i,t),e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.kill.success"},{text:o[1]}]})}break;default:{let t="owner, level, kill";return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.invalid"},{text:t}]})}}a.setLore(_(i)),g.setPlayerMainHand(e,a),e.sendMessage({rawtext:[{translate:"message.tlm.admin.set.after"}]}),e.sendMessage({rawtext:T.formatOutput(i)})}break;default:return void e.sendMessage({rawtext:[{translate:"message.tlm.admin.item.not_supported"}]})}}}}static test(t){let e=t.sourceEntity;c("test"),e.postClientMessage("id","value")}static debug(t){let e=t.sourceEntity,a=["touhou_little_maid:power_point","thlmm:maid_spawn_egg","minecraft:cake","touhou_little_maid:maid_backpack_big","touhou_little_maid:maid_backpack_middle","touhou_little_maid:maid_backpack_small","touhou_little_maid:camera","touhou_little_maid:chisel","minecraft:clay","minecraft:flint_and_steel","minecraft:netherrack","touhou_little_maid:npc_tool","touhou_little_maid:photo","touhou_little_maid:smart_slab_has_maid","touhou_little_maid:fairy_spawn_egg","touhou_little_maid:fairy_headwear_0","touhou_little_maid:warden_skull","touhou_little_maid:hakurei_gohei_crafting_table","touhou_little_maid:hakurei_gohei_cherry","thlms:border_sign.boundary_between_wave_and_particle","thlms:boundary_between_wave_and_particle_3d","thlms:gossip","thlms:magic_sign.milky_way","thlms:metal_sign.metal_fatigue","thlms:night_sign.night_bird","touhou_little_maid:dragon_skull","touhou_little_maid:gold_microwaver_item","touhou_little_maid:magic_powder","touhou_little_maid:memorizable_gensokyo"];for(let t of a)e.dimension.spawnItem(new i.ItemStack(t,1),e.location)}static info(t){let e=t.sourceEntity,a=e.getBlockFromViewDirection().block;if(void 0!==a){let t=`block: ${a.typeId}`,i=a.permutation.getAllStates();for(let e in i)t+=`\n ${e} - ${i[e]}`;e.sendMessage(t)}let i=g.getPlayerMainHand(e);void 0!==i&&e.sendMessage(`item: ${i.typeId}`)}}const Pt="touhou_little_maid:garage_kit_block",Ct="touhou_little_maid:statues_block";class Mt{static getBlockEntity(t,e=!1){return t.dimension.getEntities({families:[e?"thlm:garage_kit_solid":"thlm:garage_kit_un_solid"],closest:!0,maxDistance:.5,location:{x:t.location.x+.5,y:t.location.y,z:t.location.z+.5}})[0]}static registerCC(t){t.blockComponentRegistry.registerCustomComponent("tlm:garage_kit",{onPlayerDestroy(t){let e=Mt.getBlockEntity(t.block,!0);void 0!==e&&e.triggerEvent("thlmm:u")}}),t.blockComponentRegistry.registerCustomComponent("tlm:garage_kit_un_solid",{onPlayerDestroy(t){let e=Mt.getBlockEntity(t.block,!1);void 0!==e&&e.triggerEvent("thlmm:u")}})}static SIZE=[{scale:.5,space:[1,1,1]},{scale:1,space:[1,2,1]},{scale:2,space:[2,4,2]},{scale:3,space:[3,6,3]}];static activate(t){let e=t.source;if(!Lt(t.block))return void v.translate(e,"message.touhou_little_maid:chisel.hit_block_error.name");let a,o=e.getComponent("minecraft:equippable").getEquipment(i.EquipmentSlot.Offhand);if(void 0===o)return void v.translate(e,"message.touhou_little_maid:chisel.offhand_not_photo.name");if("touhou_little_maid:photo"!==o.typeId)return void v.translate(e,"message.touhou_little_maid:chisel.offhand_not_photo.name");{let t=o.getLore();if(void 0===t)return void v.translate(e,"message.touhou_little_maid:photo.have_no_nbt_data.name");a=T.Skin.get(y(t))}let r=t.blockFace,n=t.block.dimension,s=1,l=1,c=[1,0];switch(r){case i.Direction.East:s=-1,l=-1,c=[1,0];break;case i.Direction.South:s=1,l=-1,c=[0,1];break;case i.Direction.West:s=1,l=1,c=[-1,0];break;default:case i.Direction.Up:case i.Direction.Down:case i.Direction.North:s=-1,l=1,c=[0,-1]}let m=this.SIZE.length;const d=t.block.location;for(;m--;m>0){let o=this.SIZE[m];if(this.match(n,o.space,d,s,l)){if(0===m){let t=n.spawnEntity("thlmm:maid",new b(d.x+.5,d.y,d.z+.5));t.setDynamicProperty("spawn_set",!0),X.Statues.scale.set(t,o.scale),X.Statues.space.set(t,new b(o.space[0],o.space[1],o.space[2])),X.Skin.setPack(t,a.pack),X.Skin.setIndex(t,a.index),t.triggerEvent("become_garage_kit_un_solid"),t.teleport(t.location,{facingLocation:new b(t.location.x+c[0],t.location.y,t.location.z+c[1])}),n.fillBlocks(new i.BlockVolume(d,d),Pt)}else{let e=[s*(o.space[0]-1),o.space[1]-1,l*(o.space[2]-1)],r=new b(d.x+e[0],d.y+e[1],d.z+e[2]),m=n.spawnEntity("thlmm:maid",new b(d.x+e[0]/2+.5,d.y,d.z+e[2]/2+.5));m.setDynamicProperty("spawn_set",!0),X.Statues.scale.set(m,o.scale),X.Statues.space.set(m,new b(o.space[0],o.space[1],o.space[2])),X.Skin.setPack(m,a.pack),X.Skin.setIndex(m,a.index),m.triggerEvent("become_statues"),m.teleport(m.location,{facingLocation:new b(m.location.x+c[0],m.location.y,m.location.z+c[1])}),n.fillBlocks(new i.BlockVolume(t.block.location,r),Ct)}return g.damageMainHandStack(e),void e.playSound("land.anvil")}}}static match(t,e,a,i,o){for(let r=0;r<e[0];r++)for(let n=0;n<e[1];n++)for(let s=0;s<e[2];s++)try{if(!Lt(t.getBlock(new b(a.x+i*r,a.y+n,a.z+o*s))))return!1}catch{return!1}return!0}static scan(t){let e=t.entity;switch(X.Work.get(e)){case-2:{let t=X.Statues.space.get(e),a=new b(e.location.x-t.x/2+.5,e.location.y,e.location.z-t.z/2+.5),o=new b(a.x+t.x-1,a.y+t.y-1,a.z+t.z-1),r=e.dimension.getBlocks(new i.BlockVolume(a,o),{includeTypes:[Ct]},!0);r.getCapacity()<t.x*t.y*t.z&&(e.dimension.fillBlocks(r,"minecraft:clay"),X.despawn(e))}break;case-3:{let t=e.dimension.getBlock(e.location);void 0!==t&&t.typeId===Pt||X.despawn(e)}break;case-4:{let t=e.dimension.getBlock(e.location);if(void 0===t||t.typeId!==Pt){let t=new i.ItemStack("touhou_little_maid:garage_kit",1),a=X.Skin.getPack(e),o=X.Skin.getIndex(e);t.setLore([`${a},${o}`]),e.dimension.spawnItem(t,e.location),X.despawn(e)}}}}static placeEvent(t){if(Et(t.block.typeId))return;let e=t.block.location;switch(t.blockFace){case i.Direction.Down:e.y--;break;case i.Direction.Up:e.y++;break;case i.Direction.East:e.x++;break;case i.Direction.West:e.x--;break;case i.Direction.South:e.z++;break;case i.Direction.North:e.z--;break;default:return}let a=t.source,o=a.dimension;if(!o.getBlock(e).isAir)return;let r=a.getRotation();o.fillBlocks(new i.BlockVolume(e,e),i.BlockPermutation.resolve(Pt,{"thlm:solid":!0})),e.x+=.5,e.z+=.5;let n=o.spawnEntity("thlmm:maid",e);n.setDynamicProperty("spawn_set",!0);let s=t.itemStack.getLore();if(void 0===s||0===s.length)return;let l=s[0].split(","),c=this.SIZE[0];X.Statues.scale.set(n,c.scale),X.Statues.space.set(n,new b(c.space[0],c.space[1],c.space[2])),X.Skin.setPack(n,Number(l[0])),X.Skin.setIndex(n,Number(l[1])),n.triggerEvent("become_garage_kit_solid"),r.x=0,r.y>=0?(r.y<45?r.y=0:r.y<135?r.y=90:r.y=180,r.y-=180):(r.y>-45?r.y=0:r.y>-135?r.y=-90:r.y=180,r.y+=180),n.setRotation(r);let m=a.getComponent("inventory").container,d=a.selectedSlotIndex;if(1===t.itemStack.amount)m.setItem(d);else{let t=m.getItem(d);t.amount--,m.setItem(d,t)}t.cancel=!0}}function Lt(t){return void 0!==t&&"minecraft:clay"===t.typeId}const zt=[12,16,10],Bt=zt.length+zt.length%2;class At{static onUseEvent(t){let e=g.getPlayerMainHand(t.source);if(void 0===e)return;let a=this.getBookPage(e);this.sendForm(t.source,a.chapter,a.page)}static sendForm(t,e,a){let i="",o=0,r=[];zt.forEach((t=>{r.push(o.toString().padStart(3,"0")),o+=t}));let n=[];n.push(zt.length.toString().padStart(2,"0")),n.push(o.toString().padStart(3,"0")),n.push(this.getTotalByChapter(e,a).toString().padStart(3,"0")),n.push(-1===e?"1":"0"),i+="_1"+n.join("")+"a";let s=0,l=0;for(;;){let t="";for(let e=0;e<3&&!(s>=r.length);e++)t=r[s]+t,s++;if(t+="bcdefghijklmnopqrstuvwxyz"[l],t=t.padStart(10,"0"),i+="_1"+t,l++,s>=r.length)break}const c=(new at.ActionFormData).title("/TLM_B textures/ui/tlm_book_title").body(i).button({rawtext:[{translate:"tlm.book.chapter1"}]},"textures/items/memorizable_gensokyo").button({rawtext:[{translate:"tlm.book.chapter2"}]},"textures/ui/chapter_maid").button({rawtext:[{translate:"tlm.book.chapter3"}]},"textures/items/microwaver/magic_powder").button("placeholder");for(let t=0;t<zt.length;t++)for(let e=0;e<zt[t];e++)c.button({rawtext:[{translate:`tlm.${t}.${e}`,with:["\n"]}]});c.show(t).then((e=>{let a=g.getPlayerMainHand(t);if(void 0!==a&&"touhou_little_maid:memorizable_gensokyo"===a.typeId){let i=this.getChapterByTotal(e.selection);this.setBookPage(a,i.chapter,i.page),g.setPlayerMainHand(t,a)}}))}static getChapterByTotal(t){if(void 0===t)return{chapter:-1,page:0};let e=0,a=t-Bt;for(;e<zt.length&&a>=zt[e];e++)a-=zt[e];return{chapter:e,page:a}}static getTotalByChapter(t,e){if(void 0===t||t<0||void 0===e||e<0)return 0;let a=e;for(let e=0;e<t;e++)a+=zt[e];return a}static setBookPage(t,e,a){t.setLore(_(`tlmb:${e}:${a}`))}static getBookPage(t){let e=t.getLore();if(void 0!==e&&1===e.length){let t=y(e[0]);return t=t.split(":"),{chapter:parseInt(t[1]),page:parseInt(t[2])}}return{chapter:-1,page:0}}}class Ot{static goheiSequence=Object.freeze([ot.PELLET,ot.BALL,ot.ORBS,ot.BIG_BALL,ot.BUBBLE,ot.HEART,ot.AMULET,ot.GLOWEY_BALL]);static goheiPrefix="touhou_little_maid:hakurei_gohei_";static goheiDefault=ot.PELLET;static activate(t){try{let e=t.source,a=e.selectedSlotIndex,o=e.getComponent("inventory").container,r=o.getItem(a);if(r&&r.typeId==this.goheiPrefix+"crafting_table"){let t=new i.ItemStack(this.goheiPrefix+ot.getName(this.goheiDefault),1);t.getComponent("minecraft:enchantable").addEnchantment({type:i.EnchantmentTypes.get("infinity"),level:1}),o.setItem(a,t)}}catch{}}static transform(t,e){let a=t.itemStack;if("crafting_table"===e)this.activate(t);else for(let o=0;o<this.goheiSequence.length;o++)if(ot.getName(this.goheiSequence[o])===e){let e=o+1;e>=this.goheiSequence.length&&(e=0);let r=new i.ItemStack(this.goheiPrefix+ot.getName(this.goheiSequence[e]),1);r.getComponent("minecraft:enchantable").addEnchantments(a.getComponent("minecraft:enchantable").getEnchantments()),r.getComponent("minecraft:durability").damage=a.getComponent("minecraft:durability").damage,r.setLore(a.getLore()),r.nameTag=a.nameTag;let n=t.source;n.getComponent("inventory").container.setItem(n.selectedSlotIndex,r),n.sendMessage({rawtext:[{translate:"message.touhou_little_maid:hakurei_gohei.switch"},{translate:`danmaku.${ot.getName(this.goheiSequence[e])}.name`}]})}}}class Nt{static registerCC(t){t.blockComponentRegistry.registerCustomComponent("tlm:skull",{onPlace(t){"down"===t.block.permutation.getState("minecraft:block_face")&&t.block.setPermutation(t.block.permutation.withState("thlm:is_down",!0))}})}}class Rt{static registerCC(t){t.blockComponentRegistry.registerCustomComponent("tlm:statues",{onPlayerDestroy(t){const e=t.block.location;t.dimension.runCommand(`execute positioned ${e.x} ${e.y} ${e.z} run event entity @e[family=thlm:statues,r=8] thlmm:u`)}})}}class $t{static registerCC(t){t.blockComponentRegistry.registerCustomComponent("tlm:altar",{onPlayerDestroy(t){const e=t.block.location;t.dimension.runCommand(`execute positioned ${e.x} ${e.y} ${e.z} run function touhou_little_maid/altar_destroy`)},onPlayerInteract(t){}})}}i.world.beforeEvents.worldInitialize.subscribe((t=>{Nt.registerCC(t),Rt.registerCC(t),$t.registerCC(t),Mt.registerCC(t),vt.registerCC(t),mt.registerCC(t),wt.registerCC(t),E.registerCC(t),i.system.run((()=>{l.init(),E.init(t),Tt.Core.init(),C.initScoreboard()}))})),i.system.runTimeout((()=>{Vt.main()}),20),i.world.sendMessage("§e[Touhou Little Maid] Addon Loaded!");class Vt{static main(){i.system.afterEvents.scriptEventReceive.subscribe((t=>{i.system.run((()=>{Dt.scriptEvent(t)}))}),{namespaces:["thlm"]}),i.world.afterEvents.playerSpawn.subscribe((t=>{if(t.initialSpawn){let e=t.player;if(i.system.runTimeout((()=>{e.sendMessage({rawtext:[{translate:"message.tlm.player_join1"},{text:"\n"},{translate:"message.tlm.player_join2"}]})}),40),!1===E.test_power_number(e.name)){let t=k(e.name);E.set_power_number(e.name,0),e.dimension.runCommand(`give ${t} touhou_little_maid:memorizable_gensokyo 1`),e.dimension.runCommand(`give ${t} touhou_little_maid:smart_slab_has_maid 1`)}}}));var t={};i.world.beforeEvents.itemUseOn.subscribe((e=>{i.system.run((()=>{const a=e.block,o=e.source,r=e.itemStack;if(!t[o.name]){if(t[o.name]=!0,i.system.runTimeout((()=>{delete t[o.name]}),10),"touhou_little_maid"===a.typeId.substring(0,18)&&"altar_platform_block"===a.typeId.substring(19)&&!o.isSneaking)return et.placeItemEvent(e.block.location,o),void(e.cancel=!0);if("touhou_little_maid"===r.typeId.substring(0,18)){let t=r.typeId.substring(19);switch(t){case"photo":Tt.Interact.photoOnUseEvent(e),e.cancel=!0;break;case"smart_slab_has_maid":Tt.Interact.smartSlabOnUseEvent(e),e.cancel=!0;break;case"chisel":Mt.activate(e),e.cancel=!0;break;case"garage_kit":Mt.placeEvent(e),e.cancel=!0;break;default:"hakurei_gohei"===t.substring(0,13)&&(o.isSneaking?Ot.transform(e,t.substring(14)):"minecraft:red_wool"==a.typeId&&et.activate(o.dimension,e.block.location,e.blockFace)),e.cancel=!0}}}}))})),i.world.beforeEvents.itemUse.subscribe((t=>{i.system.run((()=>{let e=t.itemStack;if(void 0!==e&&"touhou_little_maid"===e.typeId.substring(0,18))switch(e.typeId.substring(19)){case"hakurei_gohei_crafting_table":Ot.activate(t);break;case"memorizable_gensokyo":At.onUseEvent(t)}}))})),i.world.afterEvents.dataDrivenEntityTrigger.subscribe((t=>{i.system.run((()=>{if("thlm"==t.eventId.substring(0,4))switch(t.eventId.substring(4,5)){case":":switch(t.eventId.substring(5)){case"at":et.deactivateEvent(t.entity);break;case"af":et.refreshItemsEvent(t.entity);break;case"ppi":E.init_power_point(t.entity);break;case"pps":E.scan_powerpoint(t.entity);break;case"pfd":E.fairy_death(t.entity);break;case"dfs":ut(t.entity);break;case"ddb":!function(t){let e=-1;if(t.nameTag&&"thlm:debug"==t.nameTag.substring(0,10)&&(e=parseInt(t.nameTag.substring(10))),5===e){let e=nt.create().setWorld(t.dimension).setThrower(t).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,1,0)).setColor(it.RANDOM).setType(ot.GLOWEY_BALL).setDamage(1).setGravity(0).enablePreJudge().enableVerticlePreJudge();t.dimension.getPlayers({closest:1,location:t.location,name:"Voyage1976"})[0];const a=18;let o=65/a;for(let r=0;r<a;r++)i.system.runTimeout((()=>{let a=t.dimension.getEntities({closest:1,location:t.location,families:["phantom"]})[0];if(void 0===a)return;let i=.5*(x.length({x:t.location.x-a.location.x,y:t.location.y-a.location.y,z:t.location.z-a.location.z})/6+1);t.teleport(t.location,{facingLocation:a.location}),e.setTarget(a).setVelocity(i).aimedShot()}),o*r);return}let a=t.target;if(null!=a)switch(e){case 0:{let e=nt.create().setWorld(t.dimension).setThrower(t).setTarget(a).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,1,0)).setRandomColor().setType(ot.BALL).setDamage(6).setGravity(0).setVelocity(1).setInaccuracy(0).setFanNum(17).setYawTotal(Math.PI/4);e.fanShapedShot();let i=Math.PI/8;for(let t=-4;t<4;t++)e.setAxisRotation_axis(t*i).fanShapedShot()}break;case 1:var o=nt.create().setWorld(t.dimension).setThrower(t).setTarget(a).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,1,0)).setColor(it.random()).setType(ot.BALL).setDamage(6).setGravity(0).setVelocity(.6).setInaccuracy(Math.PI/30);for(let t=0;t<40;t++)i.system.runTimeout((()=>{o.aimedShot()}),t+10);break;case 2:{let e=nt.create().setWorld(t.dimension).setThrower(t).setTarget(a).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,1,0)).setRandomColor().setType(ot.BALL).setDamage(6).setGravity(0).setVelocity(.6).setInaccuracy(0).setFanNum(17).setYawTotal(Math.PI/4);e.fanShapedShot();let i=Math.PI/16;for(let t=-4;t<4;t++)e.setAxisRotation_direction(t*i).fanShapedShot()}break;case 3:var r=nt.create().setWorld(t.dimension).setThrower(t).setTarget(a).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,1,0)).setColor(it.RANDOM).setType(ot.STAR).setDamage(6).setGravity(0).setVelocity(.8).setInaccuracy(Math.PI/7),n=nt.create().setWorld(t.dimension).setThrower(t).setTarget(a).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,1,0)).setColor(it.RANDOM).setType(ot.BIG_STAR).setDamage(6).setGravity(0).setVelocity(.6).setInaccuracy(Math.PI/15);for(let t=0;t<20;t++)i.system.runTimeout((()=>{r.setVelocity(m(.3,1)).aimedShot(),r.setVelocity(m(.3,1)).aimedShot(),r.setVelocity(m(.3,1)).aimedShot(),n.setVelocity(m(.3,1)).aimedShot(),n.setVelocity(m(.3,1)).aimedShot()}),t+10);break;case 4:mt.shoot(t,void 0);for(let e=0;e<0;e++)i.system.runTimeout((()=>{for(let e=0;e<5;e++)mt.shoot(t,void 0)}),e);break;case 5:break;case 6:var s=nt.create().setWorld(t.dimension).setThrower(t).setTarget(a).setThrowerOffSet(new b(0,1,0)).setTargetOffSet(new b(0,1,0)).setColor(it.RED).setType(ot.GLOWEY_BALL).setDamage(0).setGravity(0).setVelocity(.1);for(let t=0;t<80;t++)i.system.runTimeout((()=>{s.aimedShot(),s.aimedShot()}),t);break;case 7:{if(ft)return;ft=!0;let e=new rt(t.dimension,t).setDamage(1).setGravityVelocity(.2).setThrowerOffset(new b(0,1,0)).setDanmakuType(ot.GLOWEY_BALL).setColor(it.RED),a=t.getViewDirection(),o=x.getAnyVerticalVector(a).normalized();var l=function(){i.system.runTimeout((()=>{(ht>60||ht<-60)&&(gt=-gt),ht+=gt;let t=x.rotate_axis(a,o,ht*Math.PI/180);e.shoot(t.x,t.y,t.z,.1),l()}),1)};l()}break;default:ut(t)}}(t.entity);break;case"b":Tt.boxOpenEvent(t);break;case"n":Tt.NPCInteract(t);break;case"h":Tt.Hug.seatScan(t)}break;case"m":switch(t.eventId.substring(6,7)){case"a":Tt.Shedule.danmakuAttack(t);break;case"d":Tt.Core.onDeathEvent(t);break;case"f":Tt.Core.onTamed(t);break;case"h":Tt.Shedule.returnHomeEvent(t);break;case"i":Tt.Interact.inventoryModeEvent(t);break;case"j":Tt.Hug.startEvent(t);break;case"k":Tt.Hug.stopEvent(t);break;case"l":Tt.setLevelEvent(t);break;case"m":Tt.Interact.onInteractEvent(t);break;case"n":Tt.onNPCEvent(t);break;case"p":Tt.Interact.onPhotoEvent(t);break;case"s":Tt.Interact.sitModeEvent(t);break;case"t":Tt.Shedule.timerEvent(t);break;case"u":Mt.scan(t);break;case"v":Tt.Interact.onSitEvent(t);break;case"w":Tt.Interact.onStandEvent(t);break;case"0":Tt.Core.onSpawnEvent(t);break;case"1":Tt.Interact.onSmartSlabRecycleEvent(t)}break;case"b":switch(t.eventId.substring(6)){case"g":Tt.Core.tombstoneAttackEvent(t);break;case"t0":Tt.Interact.backpackTypeChangeEvent(t,0);break;case"t1":Tt.Interact.backpackTypeChangeEvent(t,1);break;case"t2":Tt.Interact.backpackTypeChangeEvent(t,2);break;case"t3":Tt.Interact.backpackTypeChangeEvent(t,3)}break;case"w":switch(t.eventId.substring(6,7)){case"d":vt.despawnEvent(t);break;case"f":vt.finishEvent(t);break;case"i":vt.interactEventNoItem(t);break;case"s":vt.interactEventNoItemSneaking(t)}}}))})),i.world.afterEvents.entityDie.subscribe((t=>{let e=t.damageSource.damagingEntity;void 0!==e&&"thlmm:maid"===e.typeId&&Tt.Shedule.killEvent(t)})),i.world.afterEvents.entityHitEntity.subscribe((t=>{i.system.run((()=>{let e=t.hitEntity.typeId;"thlm"===e.substring(0,4)&&"t"===e.charAt(4)&&q.targetAcquire(t)}))})),i.world.afterEvents.playerPlaceBlock.subscribe((t=>{let e=t.block;"touhou_little_maid"===e.typeId.substring(0,18)&&"altar_platform_block"===e.typeId.substring(19)&&(player.isSneaking||et.placeItemEvent(t.block.location,player))})),i.world.afterEvents.projectileHitBlock.subscribe((t=>{i.system.run((()=>{var e=t.projectile;if(void 0!==e)try{var a=t.projectile.typeId;void 0!==a&&("thlmd:"==a.substring(0,6)?function(t){let e=t.projectile;if(dt[e.id])return;var a=e.id;dt[a]=!0,e.triggerEvent("despawn"),i.system.runTimeout((()=>{delete dt[a]}),4);let o=st.getForks(e.id);if(void 0!==o){for(let t of o){let e=i.world.getEntity(t);void 0!==e&&(e.triggerEvent("despawn"),dt[t]=!0,i.system.runTimeout((()=>{delete dt[t]}),4))}st.clearForks(e.id)}}(t):"touhou_little_maid:power_point"==a&&E.powerpoint_hit(e,t.dimension))}catch{}}))})),i.world.afterEvents.projectileHitEntity.subscribe((t=>{i.system.run((()=>{var e,a=t.projectile;if(void 0!==a)try{var o=t.projectile.typeId;void 0!==o&&("thlmd:"==o.substring(0,6)?(e=t,i.system.runTimeout((()=>{var t=e.projectile;if(void 0===t||dt[t.id])return;var a=e.getEntityHit();if(void 0===a)return;if(!st.applyDamage(e.source,t,a.entity))return;let o=t.getDynamicProperty("piercing");if(void 0===o||o<=1){t.triggerEvent("despawn");var r=t.id;dt[r]=!0,i.system.runTimeout((()=>{delete dt[r]}),2);let e=st.getForks(t.id);if(void 0!==e){for(let t of e){let e=i.world.getEntity(t);void 0!==e&&(e.triggerEvent("despawn"),dt[t]=!0,i.system.runTimeout((()=>{delete dt[t]}),4))}st.clearForks(t.id)}}else o--,t.setDynamicProperty("piercing",o)}),1)):"touhou_little_maid:power_point"==o&&E.powerpoint_hit(a,t.dimension))}catch{}}))})),i.system.runInterval((()=>{for(let t of i.world.getAllPlayers()){let e=t.getComponent("equippable").getEquipment(i.EquipmentSlot.Mainhand);if(void 0!==e&&"touhou_little_maid"===e.typeId.substring(0,18)){"hakurei_gohei"==e.typeId.substring(19).substring(0,13)&&E.show(t)}}}),15),i.system.runInterval((()=>{for(let t of i.world.getAllPlayers())E.scan_power_point(t)}),20),i.system.runInterval((()=>{for(let t of i.world.getPlayers({gameMode:i.GameMode.creative}))t.runCommand("function touhou_little_maid/check")}),80)}}